var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function t(e){if(e.__esModule)return e;var t=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach((function(n){var o=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,o.get?o:{enumerable:!0,get:function(){return e[n]}})})),t}var n=class e{constructor(e,t=new Map,n=0){this.prefix=e,this._existing=t,this.counter=n}clone(){const{prefix:t,_existing:n,counter:o}=this;return new e(t,new Map(n),o)}getId(e){const t=e&&this._existing.get(e);if(t)return t;const n=this.prefix+this.counter;return this.counter++,e&&this._existing.set(e,n),n}hasId(e){return this._existing.has(e)}getOldIds(){return[...this._existing.keys()]}};!function(e,t){if(!e.setImmediate){var n,o,r,a,i,s=1,l={},c=!1,d=e.document,u=Object.getPrototypeOf&&Object.getPrototypeOf(e);u=u&&u.setTimeout?u:e,"[object process]"==={}.toString.call(e.process)?n=function(e){process.nextTick((function(){h(e)}))}:!function(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}()?e.MessageChannel?((r=new MessageChannel).port1.onmessage=function(e){h(e.data)},n=function(e){r.port2.postMessage(e)}):d&&"onreadystatechange"in d.createElement("script")?(o=d.documentElement,n=function(e){var t=d.createElement("script");t.onreadystatechange=function(){h(e),t.onreadystatechange=null,o.removeChild(t),t=null},o.appendChild(t)}):n=function(e){setTimeout(h,0,e)}:(a="setImmediate$"+Math.random()+"$",i=function(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(a)&&h(+t.data.slice(a.length))},e.addEventListener?e.addEventListener("message",i,!1):e.attachEvent("onmessage",i),n=function(t){e.postMessage(a+t,"*")}),u.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),o=0;o<t.length;o++)t[o]=arguments[o+1];var r={callback:e,args:t};return l[s]=r,n(s),s++},u.clearImmediate=p}function p(e){delete l[e]}function h(e){if(c)setTimeout(h,0,e);else{var t=l[e];if(t){c=!0;try{!function(e){var t=e.callback,n=e.args;switch(n.length){case 0:t();break;case 1:t(n[0]);break;case 2:t(n[0],n[1]);break;case 3:t(n[0],n[1],n[2]);break;default:t.apply(void 0,n)}}(t)}finally{p(e),c=!1}}}}}("undefined"==typeof self?e:self);const o=self.crypto||self.msCrypto;var r=class{constructor(e){if(!o||!o.subtle)throw new Error("crypto.subtle not found.");if("sha256"===e)this.algorithm={name:"SHA-256"};else{if("sha1"!==e)throw new Error(`Unsupport algorithm "${e}".`);this.algorithm={name:"SHA-1"}}this._content=""}update(e){this._content+=e}async digest(){const e=(new TextEncoder).encode(this._content),t=new Uint8Array(await o.subtle.digest(this.algorithm,e));let n="";for(let e=0;e<t.length;++e)n+=t[e].toString(16).padStart(2,"0");return n}},a=class{constructor(e){this.current=e.sort(),this.done=!1,this.dir=new Map;for(let t=0;t<e.length;++t)this.dir.set(e[t],!0)}hasNext(){return!this.done}next(){const{current:e,dir:t}=this,n=e.slice();let o=null,r=0;const a=e.length;for(let n=0;n<a;++n){const i=e[n],s=t.get(i);(null===o||i>o)&&(s&&n>0&&i>e[n-1]||!s&&n<a-1&&i>e[n+1])&&(o=i,r=n)}if(null===o)this.done=!0;else{const n=t.get(o)?r-1:r+1;e[r]=e[n],e[n]=o;for(const n of e)n>o&&t.set(n,!t.get(n))}return n}};const i="http://www.w3.org/1999/02/22-rdf-syntax-ns#langString",s="http://www.w3.org/2001/XMLSchema#string",l={eoln:/(?:\r\n)|(?:\n)|(?:\r)/g};l.empty=new RegExp("^[ \\t]*$"),l.quad=new RegExp('^[ \\t]*(?:(?:<([^:]+:[^>]*)>)|(_:(?:[A-Za-zÀ-ÖØ-öø-˿Ͱ-ͽͿ-῿‌-‍⁰-↏Ⰰ-⿯、-퟿豈-﷏ﷰ-�_0-9])(?:(?:[A-Za-zÀ-ÖØ-öø-˿Ͱ-ͽͿ-῿‌-‍⁰-↏Ⰰ-⿯、-퟿豈-﷏ﷰ-�_0-9-·̀-ͯ‿-⁀.])*(?:[A-Za-zÀ-ÖØ-öø-˿Ͱ-ͽͿ-῿‌-‍⁰-↏Ⰰ-⿯、-퟿豈-﷏ﷰ-�_0-9-·̀-ͯ‿-⁀]))?))[ \\t]+(?:<([^:]+:[^>]*)>)[ \\t]+(?:(?:<([^:]+:[^>]*)>)|(_:(?:[A-Za-zÀ-ÖØ-öø-˿Ͱ-ͽͿ-῿‌-‍⁰-↏Ⰰ-⿯、-퟿豈-﷏ﷰ-�_0-9])(?:(?:[A-Za-zÀ-ÖØ-öø-˿Ͱ-ͽͿ-῿‌-‍⁰-↏Ⰰ-⿯、-퟿豈-﷏ﷰ-�_0-9-·̀-ͯ‿-⁀.])*(?:[A-Za-zÀ-ÖØ-öø-˿Ͱ-ͽͿ-῿‌-‍⁰-↏Ⰰ-⿯、-퟿豈-﷏ﷰ-�_0-9-·̀-ͯ‿-⁀]))?)|(?:"([^"\\\\]*(?:\\\\.[^"\\\\]*)*)"(?:(?:\\^\\^(?:<([^:]+:[^>]*)>))|(?:@([a-zA-Z]+(?:-[a-zA-Z0-9]+)*)))?))[ \\t]*(?:\\.|(?:(?:(?:<([^:]+:[^>]*)>)|(_:(?:[A-Za-zÀ-ÖØ-öø-˿Ͱ-ͽͿ-῿‌-‍⁰-↏Ⰰ-⿯、-퟿豈-﷏ﷰ-�_0-9])(?:(?:[A-Za-zÀ-ÖØ-öø-˿Ͱ-ͽͿ-῿‌-‍⁰-↏Ⰰ-⿯、-퟿豈-﷏ﷰ-�_0-9-·̀-ͯ‿-⁀.])*(?:[A-Za-zÀ-ÖØ-öø-˿Ͱ-ͽͿ-῿‌-‍⁰-↏Ⰰ-⿯、-퟿豈-﷏ﷰ-�_0-9-·̀-ͯ‿-⁀]))?))[ \\t]*\\.))[ \\t]*$');var c=class e{static parse(e){const t=[],n={},o=e.split(l.eoln);let r=0;for(const e of o){if(r++,l.empty.test(e))continue;const o=e.match(l.quad);if(null===o)throw new Error("N-Quads parse error on line "+r+".");const a={subject:null,predicate:null,object:null,graph:null};if(void 0!==o[1]?a.subject={termType:"NamedNode",value:o[1]}:a.subject={termType:"BlankNode",value:o[2]},a.predicate={termType:"NamedNode",value:o[3]},void 0!==o[4]?a.object={termType:"NamedNode",value:o[4]}:void 0!==o[5]?a.object={termType:"BlankNode",value:o[5]}:(a.object={termType:"Literal",value:void 0,datatype:{termType:"NamedNode"}},void 0!==o[7]?a.object.datatype.value=o[7]:void 0!==o[8]?(a.object.datatype.value=i,a.object.language=o[8]):a.object.datatype.value=s,a.object.value=o[6].replace(p,(function(e,t,n,o){if(t)switch(t){case"t":return"\t";case"b":return"\b";case"n":return"\n";case"r":return"\r";case"f":return"\f";case'"':return'"';case"'":return"'";case"\\":return"\\"}if(n)return String.fromCharCode(parseInt(n,16));if(o)throw new Error("Unsupported U escape")}))),void 0!==o[9]?a.graph={termType:"NamedNode",value:o[9]}:void 0!==o[10]?a.graph={termType:"BlankNode",value:o[10]}:a.graph={termType:"DefaultGraph",value:""},a.graph.value in n){let e=!0;const o=n[a.graph.value];for(const t of o)if(d(t,a)){e=!1;break}e&&(o.push(a),t.push(a))}else n[a.graph.value]=[a],t.push(a)}return t}static serialize(t){Array.isArray(t)||(t=e.legacyDatasetToQuads(t));const n=[];for(const o of t)n.push(e.serializeQuad(o));return n.sort().join("")}static serializeQuad(e){const t=e.subject,n=e.predicate,o=e.object,r=e.graph;let a="";return"NamedNode"===t.termType?a+=`<${t.value}>`:a+=`${t.value}`,a+=` <${n.value}> `,"NamedNode"===o.termType?a+=`<${o.value}>`:"BlankNode"===o.termType?a+=o.value:(a+=`"${function(e){return e.replace(u,(function(e){switch(e){case'"':return'\\"';case"\\":return"\\\\";case"\n":return"\\n";case"\r":return"\\r"}}))}(o.value)}"`,o.datatype.value===i?o.language&&(a+=`@${o.language}`):o.datatype.value!==s&&(a+=`^^<${o.datatype.value}>`)),"NamedNode"===r.termType?a+=` <${r.value}>`:"BlankNode"===r.termType&&(a+=` ${r.value}`),a+=" .\n",a}static legacyDatasetToQuads(e){const t=[],n={"blank node":"BlankNode",IRI:"NamedNode",literal:"Literal"};for(const o in e){e[o].forEach((e=>{const r={};for(const t in e){const o=e[t],a={termType:n[o.type],value:o.value};"Literal"===a.termType&&(a.datatype={termType:"NamedNode"},"datatype"in o&&(a.datatype.value=o.datatype),"language"in o?("datatype"in o||(a.datatype.value=i),a.language=o.language):"datatype"in o||(a.datatype.value=s)),r[t]=a}r.graph="@default"===o?{termType:"DefaultGraph",value:""}:{termType:o.startsWith("_:")?"BlankNode":"NamedNode",value:o},t.push(r)}))}return t}};function d(e,t){return e.subject.termType===t.subject.termType&&e.object.termType===t.object.termType&&(e.subject.value===t.subject.value&&e.predicate.value===t.predicate.value&&e.object.value===t.object.value&&("Literal"!==e.object.termType||e.object.datatype.termType===t.object.datatype.termType&&e.object.language===t.object.language&&e.object.datatype.value===t.object.datatype.value))}const u=/["\\\n\r]/g;const p=/(?:\\([tbnrf"'\\]))|(?:\\u([0-9A-Fa-f]{4}))|(?:\\U([0-9A-Fa-f]{8}))/g;var h=class{constructor(){this.name="URDNA2015",this.blankNodeInfo=new Map,this.canonicalIssuer=new n("_:c14n"),this.hashAlgorithm="sha256",this.quads=null}async main(e){this.quads=e;for(const t of e)this._addBlankNodeQuadInfo({quad:t,component:t.subject}),this._addBlankNodeQuadInfo({quad:t,component:t.object}),this._addBlankNodeQuadInfo({quad:t,component:t.graph});const t=new Map,o=[...this.blankNodeInfo.keys()];let r=0;for(const e of o)++r%100==0&&await this._yield(),await this._hashAndTrackBlankNode({id:e,hashToBlankNodes:t});const a=[...t.keys()].sort(),i=[];for(const e of a){const n=t.get(e);if(n.length>1){i.push(n);continue}const o=n[0];this.canonicalIssuer.getId(o)}for(const e of i){const t=[];for(const o of e){if(this.canonicalIssuer.hasId(o))continue;const e=new n("_:b");e.getId(o);const r=await this.hashNDegreeQuads(o,e);t.push(r)}t.sort(f);for(const e of t){const t=e.issuer.getOldIds();for(const e of t)this.canonicalIssuer.getId(e)}}const s=[];for(const e of this.quads){const t={...e};t.subject=this._useCanonicalId({component:t.subject}),t.object=this._useCanonicalId({component:t.object}),t.graph=this._useCanonicalId({component:t.graph}),s.push(c.serializeQuad(t))}return s.sort(),s.join("")}async hashFirstDegreeQuads(e){const t=[],n=this.blankNodeInfo.get(e),o=n.quads;for(const n of o){const o={subject:null,predicate:n.predicate,object:null,graph:null};o.subject=this.modifyFirstDegreeComponent(e,n.subject,"subject"),o.object=this.modifyFirstDegreeComponent(e,n.object,"object"),o.graph=this.modifyFirstDegreeComponent(e,n.graph,"graph"),t.push(c.serializeQuad(o))}t.sort();const a=new r(this.hashAlgorithm);for(const e of t)a.update(e);return n.hash=await a.digest(),n.hash}async hashRelatedBlankNode(e,t,n,o){let a;a=this.canonicalIssuer.hasId(e)?this.canonicalIssuer.getId(e):n.hasId(e)?n.getId(e):this.blankNodeInfo.get(e).hash;const i=new r(this.hashAlgorithm);return i.update(o),"g"!==o&&i.update(this.getRelatedPredicate(t)),i.update(a),i.digest()}async hashNDegreeQuads(e,t){const n=new r(this.hashAlgorithm),o=await this.createHashToRelated(e,t),i=[...o.keys()].sort();for(const e of i){n.update(e);let r,i="";const s=new a(o.get(e));let l=0;for(;s.hasNext();){const e=s.next();++l%3==0&&await this._yield();let n=t.clone(),o="";const a=[];let c=!1;for(const t of e)if(this.canonicalIssuer.hasId(t)?o+=this.canonicalIssuer.getId(t):(n.hasId(t)||a.push(t),o+=n.getId(t)),0!==i.length&&o>i){c=!0;break}if(!c){for(const e of a){const t=await this.hashNDegreeQuads(e,n);if(o+=n.getId(e),o+=`<${t.hash}>`,n=t.issuer,0!==i.length&&o>i){c=!0;break}}c||(0===i.length||o<i)&&(i=o,r=n)}}n.update(i),t=r}return{hash:await n.digest(),issuer:t}}modifyFirstDegreeComponent(e,t){return"BlankNode"!==t.termType?t:{termType:"BlankNode",value:t.value===e?"_:a":"_:z"}}getRelatedPredicate(e){return`<${e.predicate.value}>`}async createHashToRelated(e,t){const n=new Map,o=this.blankNodeInfo.get(e).quads;let r=0;for(const a of o)++r%100==0&&await this._yield(),await Promise.all([this._addRelatedBlankNodeHash({quad:a,component:a.subject,position:"s",id:e,issuer:t,hashToRelated:n}),this._addRelatedBlankNodeHash({quad:a,component:a.object,position:"o",id:e,issuer:t,hashToRelated:n}),this._addRelatedBlankNodeHash({quad:a,component:a.graph,position:"g",id:e,issuer:t,hashToRelated:n})]);return n}async _hashAndTrackBlankNode({id:e,hashToBlankNodes:t}){const n=await this.hashFirstDegreeQuads(e),o=t.get(n);o?o.push(e):t.set(n,[e])}_addBlankNodeQuadInfo({quad:e,component:t}){if("BlankNode"!==t.termType)return;const n=t.value,o=this.blankNodeInfo.get(n);o?o.quads.add(e):this.blankNodeInfo.set(n,{quads:new Set([e]),hash:null})}async _addRelatedBlankNodeHash({quad:e,component:t,position:n,id:o,issuer:r,hashToRelated:a}){if("BlankNode"!==t.termType||t.value===o)return;const i=t.value,s=await this.hashRelatedBlankNode(i,e,r,n),l=a.get(s);l?l.push(i):a.set(s,[i])}_useCanonicalId({component:e}){return"BlankNode"!==e.termType||e.value.startsWith(this.canonicalIssuer.prefix)?e:{termType:"BlankNode",value:this.canonicalIssuer.getId(e.value)}}async _yield(){return new Promise((e=>setImmediate(e)))}};function f(e,t){return e.hash<t.hash?-1:e.hash>t.hash?1:0}var v=class extends h{constructor(){super(),this.name="URGNA2012",this.hashAlgorithm="sha1"}modifyFirstDegreeComponent(e,t,n){return"BlankNode"!==t.termType?t:"graph"===n?{termType:"BlankNode",value:"_:g"}:{termType:"BlankNode",value:t.value===e?"_:a":"_:z"}}getRelatedPredicate(e){return e.predicate.value}async createHashToRelated(e,t){const n=new Map,o=this.blankNodeInfo.get(e).quads;let r=0;for(const a of o){let o,i;if("BlankNode"===a.subject.termType&&a.subject.value!==e)i=a.subject.value,o="p";else{if("BlankNode"!==a.object.termType||a.object.value===e)continue;i=a.object.value,o="r"}++r%100==0&&await this._yield();const s=await this.hashRelatedBlankNode(i,a,t,o),l=n.get(s);l?l.push(i):n.set(s,[i])}return n}},g=class{constructor(){this.name="URDNA2015",this.blankNodeInfo=new Map,this.canonicalIssuer=new n("_:c14n"),this.hashAlgorithm="sha256",this.quads=null}main(e){this.quads=e;for(const t of e)this._addBlankNodeQuadInfo({quad:t,component:t.subject}),this._addBlankNodeQuadInfo({quad:t,component:t.object}),this._addBlankNodeQuadInfo({quad:t,component:t.graph});const t=new Map,o=[...this.blankNodeInfo.keys()];for(const e of o)this._hashAndTrackBlankNode({id:e,hashToBlankNodes:t});const r=[...t.keys()].sort(),a=[];for(const e of r){const n=t.get(e);if(n.length>1){a.push(n);continue}const o=n[0];this.canonicalIssuer.getId(o)}for(const e of a){const t=[];for(const o of e){if(this.canonicalIssuer.hasId(o))continue;const e=new n("_:b");e.getId(o);const r=this.hashNDegreeQuads(o,e);t.push(r)}t.sort(y);for(const e of t){const t=e.issuer.getOldIds();for(const e of t)this.canonicalIssuer.getId(e)}}const i=[];for(const e of this.quads){const t={...e};t.subject=this._useCanonicalId({component:t.subject}),t.object=this._useCanonicalId({component:t.object}),t.graph=this._useCanonicalId({component:t.graph}),i.push(c.serializeQuad(t))}return i.sort(),i.join("")}hashFirstDegreeQuads(e){const t=[],n=this.blankNodeInfo.get(e),o=n.quads;for(const n of o){const o={subject:null,predicate:n.predicate,object:null,graph:null};o.subject=this.modifyFirstDegreeComponent(e,n.subject,"subject"),o.object=this.modifyFirstDegreeComponent(e,n.object,"object"),o.graph=this.modifyFirstDegreeComponent(e,n.graph,"graph"),t.push(c.serializeQuad(o))}t.sort();const a=new r(this.hashAlgorithm);for(const e of t)a.update(e);return n.hash=a.digest(),n.hash}hashRelatedBlankNode(e,t,n,o){let a;a=this.canonicalIssuer.hasId(e)?this.canonicalIssuer.getId(e):n.hasId(e)?n.getId(e):this.blankNodeInfo.get(e).hash;const i=new r(this.hashAlgorithm);return i.update(o),"g"!==o&&i.update(this.getRelatedPredicate(t)),i.update(a),i.digest()}hashNDegreeQuads(e,t){const n=new r(this.hashAlgorithm),o=this.createHashToRelated(e,t),i=[...o.keys()].sort();for(const e of i){n.update(e);let r,i="";const s=new a(o.get(e));for(;s.hasNext();){const e=s.next();let n=t.clone(),o="";const a=[];let l=!1;for(const t of e)if(this.canonicalIssuer.hasId(t)?o+=this.canonicalIssuer.getId(t):(n.hasId(t)||a.push(t),o+=n.getId(t)),0!==i.length&&o>i){l=!0;break}if(!l){for(const e of a){const t=this.hashNDegreeQuads(e,n);if(o+=n.getId(e),o+=`<${t.hash}>`,n=t.issuer,0!==i.length&&o>i){l=!0;break}}l||(0===i.length||o<i)&&(i=o,r=n)}}n.update(i),t=r}return{hash:n.digest(),issuer:t}}modifyFirstDegreeComponent(e,t){return"BlankNode"!==t.termType?t:{termType:"BlankNode",value:t.value===e?"_:a":"_:z"}}getRelatedPredicate(e){return`<${e.predicate.value}>`}createHashToRelated(e,t){const n=new Map,o=this.blankNodeInfo.get(e).quads;for(const r of o)this._addRelatedBlankNodeHash({quad:r,component:r.subject,position:"s",id:e,issuer:t,hashToRelated:n}),this._addRelatedBlankNodeHash({quad:r,component:r.object,position:"o",id:e,issuer:t,hashToRelated:n}),this._addRelatedBlankNodeHash({quad:r,component:r.graph,position:"g",id:e,issuer:t,hashToRelated:n});return n}_hashAndTrackBlankNode({id:e,hashToBlankNodes:t}){const n=this.hashFirstDegreeQuads(e),o=t.get(n);o?o.push(e):t.set(n,[e])}_addBlankNodeQuadInfo({quad:e,component:t}){if("BlankNode"!==t.termType)return;const n=t.value,o=this.blankNodeInfo.get(n);o?o.quads.add(e):this.blankNodeInfo.set(n,{quads:new Set([e]),hash:null})}_addRelatedBlankNodeHash({quad:e,component:t,position:n,id:o,issuer:r,hashToRelated:a}){if("BlankNode"!==t.termType||t.value===o)return;const i=t.value,s=this.hashRelatedBlankNode(i,e,r,n),l=a.get(s);l?l.push(i):a.set(s,[i])}_useCanonicalId({component:e}){return"BlankNode"!==e.termType||e.value.startsWith(this.canonicalIssuer.prefix)?e:{termType:"BlankNode",value:this.canonicalIssuer.getId(e.value)}}};function y(e,t){return e.hash<t.hash?-1:e.hash>t.hash?1:0}var m=class extends g{constructor(){super(),this.name="URGNA2012",this.hashAlgorithm="sha1"}modifyFirstDegreeComponent(e,t,n){return"BlankNode"!==t.termType?t:"graph"===n?{termType:"BlankNode",value:"_:g"}:{termType:"BlankNode",value:t.value===e?"_:a":"_:z"}}getRelatedPredicate(e){return e.predicate.value}createHashToRelated(e,t){const n=new Map,o=this.blankNodeInfo.get(e).quads;for(const r of o){let o,a;if("BlankNode"===r.subject.termType&&r.subject.value!==e)a=r.subject.value,o="p";else{if("BlankNode"!==r.object.termType||r.object.value===e)continue;a=r.object.value,o="r"}const i=this.hashRelatedBlankNode(a,r,t,o),s=n.get(i);s?s.push(a):n.set(i,[a])}return n}},x=t(Object.freeze({__proto__:null,default:{}}));let b;try{b=x}catch(e){}const w={};var j=w;w.NQuads=c,w.IdentifierIssuer=n,w._rdfCanonizeNative=function(e){return e&&(b=e),b},w.canonize=async function(e,t){if(Array.isArray(e)||(e=w.NQuads.legacyDatasetToQuads(e)),t.useNative){if(!b)throw new Error("rdf-canonize-native not available");return new Promise(((n,o)=>b.canonize(e,t,((e,t)=>e?o(e):n(t)))))}if("URDNA2015"===t.algorithm)return new h(t).main(e);if("URGNA2012"===t.algorithm)return new v(t).main(e);if(!("algorithm"in t))throw new Error("No RDF Dataset Canonicalization algorithm specified.");throw new Error("Invalid RDF Dataset Canonicalization algorithm: "+t.algorithm)},w._canonizeSync=function(e,t){if(Array.isArray(e)||(e=w.NQuads.legacyDatasetToQuads(e)),t.useNative){if(b)return b.canonizeSync(e,t);throw new Error("rdf-canonize-native not available")}if("URDNA2015"===t.algorithm)return new g(t).main(e);if("URGNA2012"===t.algorithm)return new m(t).main(e);if(!("algorithm"in t))throw new Error("No RDF Dataset Canonicalization algorithm specified.");throw new Error("Invalid RDF Dataset Canonicalization algorithm: "+t.algorithm)};const I={};var N=I;I.isArray=Array.isArray,I.isBoolean=e=>"boolean"==typeof e||"[object Boolean]"===Object.prototype.toString.call(e),I.isDouble=e=>I.isNumber(e)&&(-1!==String(e).indexOf(".")||Math.abs(e)>=1e21),I.isEmptyObject=e=>I.isObject(e)&&0===Object.keys(e).length,I.isNumber=e=>"number"==typeof e||"[object Number]"===Object.prototype.toString.call(e),I.isNumeric=e=>!isNaN(parseFloat(e))&&isFinite(e),I.isObject=e=>"[object Object]"===Object.prototype.toString.call(e),I.isString=e=>"string"==typeof e||"[object String]"===Object.prototype.toString.call(e),I.isUndefined=e=>void 0===e;const S={};var O=S;S.isSubject=e=>{if(N.isObject(e)&&!("@value"in e||"@set"in e||"@list"in e)){return Object.keys(e).length>1||!("@id"in e)}return!1},S.isSubjectReference=e=>N.isObject(e)&&1===Object.keys(e).length&&"@id"in e,S.isValue=e=>N.isObject(e)&&"@value"in e,S.isList=e=>N.isObject(e)&&"@list"in e,S.isGraph=e=>N.isObject(e)&&"@graph"in e&&1===Object.keys(e).filter((e=>"@id"!==e&&"@index"!==e)).length,S.isSimpleGraph=e=>S.isGraph(e)&&!("@id"in e),S.isBlankNode=e=>!!N.isObject(e)&&("@id"in e?0===e["@id"].indexOf("_:"):0===Object.keys(e).length||!("@value"in e||"@set"in e||"@list"in e));var k=class extends Error{constructor(e="An unspecified JSON-LD error occurred.",t="jsonld.Error",n={}){super(e),this.name=t,this.message=e,this.details=n}};const C=j.IdentifierIssuer,L=/(?:<[^>]*?>|"[^"]*?"|[^,])+/g,A=/\s*<([^>]*?)>\s*(?:;\s*(.*))?/,D=/(.*?)=(?:(?:"([^"]*?)")|([^"]*?))\s*(?:(?:;\s*)|$)/g,T={accept:"application/ld+json, application/json"},R={};var E=R;function _(e,t){if(N.isArray(t))for(let n=0;n<t.length;++n)t[n]=_(e,t[n]);else if(O.isList(t))t["@list"]=_(e,t["@list"]);else if(N.isObject(t)){O.isBlankNode(t)&&(t["@id"]=e.getId(t["@id"]));const n=Object.keys(t).sort();for(let o=0;o<n.length;++o){const r=n[o];"@id"!==r&&(t[r]=_(e,t[r]))}}return t}R.IdentifierIssuer=C,R.clone=function(e){if(e&&"object"==typeof e){let t;if(N.isArray(e)){t=[];for(let n=0;n<e.length;++n)t[n]=R.clone(e[n])}else if(e instanceof Map){t=new Map;for(const[n,o]of e)t.set(n,R.clone(o))}else if(e instanceof Set){t=new Set;for(const n of e)t.add(R.clone(n))}else if(N.isObject(e)){t={};for(const n in e)t[n]=R.clone(e[n])}else t=e.toString();return t}return e},R.asArray=function(e){return Array.isArray(e)?e:[e]},R.buildHeaders=(e={})=>{if(Object.keys(e).some((e=>"accept"===e.toLowerCase())))throw new RangeError('Accept header may not be specified; only "'+T.accept+'" is supported.');return Object.assign({Accept:T.accept},e)},R.parseLinkHeader=e=>{const t={},n=e.match(L);for(let e=0;e<n.length;++e){let o=n[e].match(A);if(!o)continue;const r={target:o[1]},a=o[2];for(;o=D.exec(a);)r[o[1]]=void 0===o[2]?o[3]:o[2];const i=r.rel||"";Array.isArray(t[i])?t[i].push(r):t.hasOwnProperty(i)?t[i]=[t[i],r]:t[i]=r}return t},R.validateTypeValue=(e,t)=>{if(!(N.isString(e)||N.isArray(e)&&e.every((e=>N.isString(e))))){if(t&&N.isObject(e))switch(Object.keys(e).length){case 0:return;case 1:if("@default"in e&&R.asArray(e["@default"]).every((e=>N.isString(e))))return}throw new k('Invalid JSON-LD syntax; "@type" value must a string, an array of strings, an empty object, or a default object.',"jsonld.SyntaxError",{code:"invalid type value",value:e})}},R.hasProperty=(e,t)=>{if(e.hasOwnProperty(t)){const n=e[t];return!N.isArray(n)||n.length>0}return!1},R.hasValue=(e,t,n)=>{if(R.hasProperty(e,t)){let o=e[t];const r=O.isList(o);if(N.isArray(o)||r){r&&(o=o["@list"]);for(let e=0;e<o.length;++e)if(R.compareValues(n,o[e]))return!0}else if(!N.isArray(n))return R.compareValues(n,o)}return!1},R.addValue=(e,t,n,o)=>{if("propertyIsArray"in(o=o||{})||(o.propertyIsArray=!1),"valueIsArray"in o||(o.valueIsArray=!1),"allowDuplicate"in o||(o.allowDuplicate=!0),"prependValue"in o||(o.prependValue=!1),o.valueIsArray)e[t]=n;else if(N.isArray(n)){0===n.length&&o.propertyIsArray&&!e.hasOwnProperty(t)&&(e[t]=[]),o.prependValue&&(n=n.concat(e[t]),e[t]=[]);for(let r=0;r<n.length;++r)R.addValue(e,t,n[r],o)}else if(e.hasOwnProperty(t)){const r=!o.allowDuplicate&&R.hasValue(e,t,n);N.isArray(e[t])||r&&!o.propertyIsArray||(e[t]=[e[t]]),r||(o.prependValue?e[t].unshift(n):e[t].push(n))}else e[t]=o.propertyIsArray?[n]:n},R.getValues=(e,t)=>[].concat(e[t]||[]),R.removeProperty=(e,t)=>{delete e[t]},R.removeValue=(e,t,n,o)=>{"propertyIsArray"in(o=o||{})||(o.propertyIsArray=!1);const r=R.getValues(e,t).filter((e=>!R.compareValues(e,n)));0===r.length?R.removeProperty(e,t):1!==r.length||o.propertyIsArray?e[t]=r:e[t]=r[0]},R.relabelBlankNodes=(e,t)=>_((t=t||{}).issuer||new C("_:b"),e),R.compareValues=(e,t)=>e===t||(!(!O.isValue(e)||!O.isValue(t)||e["@value"]!==t["@value"]||e["@type"]!==t["@type"]||e["@language"]!==t["@language"]||e["@index"]!==t["@index"])||!!(N.isObject(e)&&"@id"in e&&N.isObject(t)&&"@id"in t)&&e["@id"]===t["@id"]),R.compareShortestLeast=(e,t)=>e.length<t.length?-1:t.length<e.length?1:e===t?0:e<t?-1:1;const M={};var P=M;M.parsers={simple:{keys:["href","scheme","authority","path","query","fragment"],regex:/^(?:([^:\/?#]+):)?(?:\/\/([^\/?#]*))?([^?#]*)(?:\?([^#]*))?(?:#(.*))?/},full:{keys:["href","protocol","scheme","authority","auth","user","password","hostname","port","path","directory","file","query","fragment"],regex:/^(([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?(?:(((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/}},M.parse=(e,t)=>{const n={},o=M.parsers[t||"full"],r=o.regex.exec(e);let a=o.keys.length;for(;a--;)n[o.keys[a]]=void 0===r[a]?null:r[a];return("https"===n.scheme&&"443"===n.port||"http"===n.scheme&&"80"===n.port)&&(n.href=n.href.replace(":"+n.port,""),n.authority=n.authority.replace(":"+n.port,""),n.port=null),n.normalizedPath=M.removeDotSegments(n.path),n},M.prependBase=(e,t)=>{if(null===e)return t;if(M.isAbsolute(t))return t;e&&!N.isString(e)||(e=M.parse(e||""));const n=M.parse(t),o={protocol:e.protocol||""};if(null!==n.authority)o.authority=n.authority,o.path=n.path,o.query=n.query;else if(o.authority=e.authority,""===n.path)o.path=e.path,null!==n.query?o.query=n.query:o.query=e.query;else{if(0===n.path.indexOf("/"))o.path=n.path;else{let t=e.path;t=t.substr(0,t.lastIndexOf("/")+1),(t.length>0||e.authority)&&"/"!==t.substr(-1)&&(t+="/"),t+=n.path,o.path=t}o.query=n.query}""!==n.path&&(o.path=M.removeDotSegments(o.path));let r=o.protocol;return null!==o.authority&&(r+="//"+o.authority),r+=o.path,null!==o.query&&(r+="?"+o.query),null!==n.fragment&&(r+="#"+n.fragment),""===r&&(r="./"),r},M.removeBase=(e,t)=>{if(null===e)return t;e&&!N.isString(e)||(e=M.parse(e||""));let n="";if(""!==e.href?n+=(e.protocol||"")+"//"+(e.authority||""):t.indexOf("//")&&(n+="//"),0!==t.indexOf(n))return t;const o=M.parse(t.substr(n.length)),r=e.normalizedPath.split("/"),a=o.normalizedPath.split("/"),i=o.fragment||o.query?0:1;for(;r.length>0&&a.length>i&&r[0]===a[0];)r.shift(),a.shift();let s="";if(r.length>0){r.pop();for(let e=0;e<r.length;++e)s+="../"}return s+=a.join("/"),null!==o.query&&(s+="?"+o.query),null!==o.fragment&&(s+="#"+o.fragment),""===s&&(s="./"),s},M.removeDotSegments=e=>{if(0===e.length)return"";const t=e.split("/"),n=[];for(;t.length>0;){const e=t.shift(),o=0===t.length;"."!==e?".."!==e?n.push(e):(n.pop(),o&&n.push("")):o&&n.push("")}return"/"===e[0]&&n.length>0&&""!==n[0]&&n.unshift(""),1===n.length&&""===n[0]?"/":n.join("/")};const J=/^([A-Za-z][A-Za-z0-9+-.]*|_):[^\s]*$/;M.isAbsolute=e=>N.isString(e)&&J.test(e),M.isRelative=e=>N.isString(e);var B=F;function F(e){var t=this;if(t instanceof F||(t=new F),t.tail=null,t.head=null,t.length=0,e&&"function"==typeof e.forEach)e.forEach((function(e){t.push(e)}));else if(arguments.length>0)for(var n=0,o=arguments.length;n<o;n++)t.push(arguments[n]);return t}function U(e,t,n){var o=t===e.head?new z(n,null,t,e):new z(n,t,t.next,e);return null===o.next&&(e.tail=o),null===o.prev&&(e.head=o),e.length++,o}function q(e,t){e.tail=new z(t,e.tail,null,e),e.head||(e.head=e.tail),e.length++}function V(e,t){e.head=new z(t,null,e.head,e),e.tail||(e.tail=e.head),e.length++}function z(e,t,n,o){if(!(this instanceof z))return new z(e,t,n,o);this.list=o,this.value=e,t?(t.next=this,this.prev=t):this.prev=null,n?(n.prev=this,this.next=n):this.next=null}F.Node=z,F.create=F,F.prototype.removeNode=function(e){if(e.list!==this)throw new Error("removing node which does not belong to this list");var t=e.next,n=e.prev;return t&&(t.prev=n),n&&(n.next=t),e===this.head&&(this.head=t),e===this.tail&&(this.tail=n),e.list.length--,e.next=null,e.prev=null,e.list=null,t},F.prototype.unshiftNode=function(e){if(e!==this.head){e.list&&e.list.removeNode(e);var t=this.head;e.list=this,e.next=t,t&&(t.prev=e),this.head=e,this.tail||(this.tail=e),this.length++}},F.prototype.pushNode=function(e){if(e!==this.tail){e.list&&e.list.removeNode(e);var t=this.tail;e.list=this,e.prev=t,t&&(t.next=e),this.tail=e,this.head||(this.head=e),this.length++}},F.prototype.push=function(){for(var e=0,t=arguments.length;e<t;e++)q(this,arguments[e]);return this.length},F.prototype.unshift=function(){for(var e=0,t=arguments.length;e<t;e++)V(this,arguments[e]);return this.length},F.prototype.pop=function(){if(this.tail){var e=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,e}},F.prototype.shift=function(){if(this.head){var e=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,e}},F.prototype.forEach=function(e,t){t=t||this;for(var n=this.head,o=0;null!==n;o++)e.call(t,n.value,o,this),n=n.next},F.prototype.forEachReverse=function(e,t){t=t||this;for(var n=this.tail,o=this.length-1;null!==n;o--)e.call(t,n.value,o,this),n=n.prev},F.prototype.get=function(e){for(var t=0,n=this.head;null!==n&&t<e;t++)n=n.next;if(t===e&&null!==n)return n.value},F.prototype.getReverse=function(e){for(var t=0,n=this.tail;null!==n&&t<e;t++)n=n.prev;if(t===e&&null!==n)return n.value},F.prototype.map=function(e,t){t=t||this;for(var n=new F,o=this.head;null!==o;)n.push(e.call(t,o.value,this)),o=o.next;return n},F.prototype.mapReverse=function(e,t){t=t||this;for(var n=new F,o=this.tail;null!==o;)n.push(e.call(t,o.value,this)),o=o.prev;return n},F.prototype.reduce=function(e,t){var n,o=this.head;if(arguments.length>1)n=t;else{if(!this.head)throw new TypeError("Reduce of empty list with no initial value");o=this.head.next,n=this.head.value}for(var r=0;null!==o;r++)n=e(n,o.value,r),o=o.next;return n},F.prototype.reduceReverse=function(e,t){var n,o=this.tail;if(arguments.length>1)n=t;else{if(!this.tail)throw new TypeError("Reduce of empty list with no initial value");o=this.tail.prev,n=this.tail.value}for(var r=this.length-1;null!==o;r--)n=e(n,o.value,r),o=o.prev;return n},F.prototype.toArray=function(){for(var e=new Array(this.length),t=0,n=this.head;null!==n;t++)e[t]=n.value,n=n.next;return e},F.prototype.toArrayReverse=function(){for(var e=new Array(this.length),t=0,n=this.tail;null!==n;t++)e[t]=n.value,n=n.prev;return e},F.prototype.slice=function(e,t){(t=t||this.length)<0&&(t+=this.length),(e=e||0)<0&&(e+=this.length);var n=new F;if(t<e||t<0)return n;e<0&&(e=0),t>this.length&&(t=this.length);for(var o=0,r=this.head;null!==r&&o<e;o++)r=r.next;for(;null!==r&&o<t;o++,r=r.next)n.push(r.value);return n},F.prototype.sliceReverse=function(e,t){(t=t||this.length)<0&&(t+=this.length),(e=e||0)<0&&(e+=this.length);var n=new F;if(t<e||t<0)return n;e<0&&(e=0),t>this.length&&(t=this.length);for(var o=this.length,r=this.tail;null!==r&&o>t;o--)r=r.prev;for(;null!==r&&o>e;o--,r=r.prev)n.push(r.value);return n},F.prototype.splice=function(e,t){e>this.length&&(e=this.length-1),e<0&&(e=this.length+e);for(var n=0,o=this.head;null!==o&&n<e;n++)o=o.next;var r=[];for(n=0;o&&n<t;n++)r.push(o.value),o=this.removeNode(o);null===o&&(o=this.tail),o!==this.head&&o!==this.tail&&(o=o.prev);for(n=2;n<arguments.length;n++)o=U(this,o,arguments[n]);return r},F.prototype.reverse=function(){for(var e=this.head,t=this.tail,n=e;null!==n;n=n.prev){var o=n.prev;n.prev=n.next,n.next=o}return this.head=t,this.tail=e,this};try{!function(e){e.prototype[Symbol.iterator]=function*(){for(let e=this.head;e;e=e.next)yield e.value}}(F)}catch(e){}const $=Symbol("max"),G=Symbol("length"),H=Symbol("lengthCalculator"),Q=Symbol("allowStale"),K=Symbol("maxAge"),X=Symbol("dispose"),Z=Symbol("noDisposeOnSet"),W=Symbol("lruList"),Y=Symbol("cache"),ee=Symbol("updateAgeOnGet"),te=()=>1;const ne=(e,t,n)=>{const o=e[Y].get(t);if(o){const t=o.value;if(oe(e,t)){if(ae(e,o),!e[Q])return}else n&&(e[ee]&&(o.value.now=Date.now()),e[W].unshiftNode(o));return t.value}},oe=(e,t)=>{if(!t||!t.maxAge&&!e[K])return!1;const n=Date.now()-t.now;return t.maxAge?n>t.maxAge:e[K]&&n>e[K]},re=e=>{if(e[G]>e[$])for(let t=e[W].tail;e[G]>e[$]&&null!==t;){const n=t.prev;ae(e,t),t=n}},ae=(e,t)=>{if(t){const n=t.value;e[X]&&e[X](n.key,n.value),e[G]-=n.length,e[Y].delete(n.key),e[W].removeNode(t)}};class ie{constructor(e,t,n,o,r){this.key=e,this.value=t,this.length=n,this.now=o,this.maxAge=r||0}}const se=(e,t,n,o)=>{let r=n.value;oe(e,r)&&(ae(e,n),e[Q]||(r=void 0)),r&&t.call(o,r.value,r.key,e)};var le=class{constructor(e){if("number"==typeof e&&(e={max:e}),e||(e={}),e.max&&("number"!=typeof e.max||e.max<0))throw new TypeError("max must be a non-negative number");this[$]=e.max||1/0;const t=e.length||te;if(this[H]="function"!=typeof t?te:t,this[Q]=e.stale||!1,e.maxAge&&"number"!=typeof e.maxAge)throw new TypeError("maxAge must be a number");this[K]=e.maxAge||0,this[X]=e.dispose,this[Z]=e.noDisposeOnSet||!1,this[ee]=e.updateAgeOnGet||!1,this.reset()}set max(e){if("number"!=typeof e||e<0)throw new TypeError("max must be a non-negative number");this[$]=e||1/0,re(this)}get max(){return this[$]}set allowStale(e){this[Q]=!!e}get allowStale(){return this[Q]}set maxAge(e){if("number"!=typeof e)throw new TypeError("maxAge must be a non-negative number");this[K]=e,re(this)}get maxAge(){return this[K]}set lengthCalculator(e){"function"!=typeof e&&(e=te),e!==this[H]&&(this[H]=e,this[G]=0,this[W].forEach((e=>{e.length=this[H](e.value,e.key),this[G]+=e.length}))),re(this)}get lengthCalculator(){return this[H]}get length(){return this[G]}get itemCount(){return this[W].length}rforEach(e,t){t=t||this;for(let n=this[W].tail;null!==n;){const o=n.prev;se(this,e,n,t),n=o}}forEach(e,t){t=t||this;for(let n=this[W].head;null!==n;){const o=n.next;se(this,e,n,t),n=o}}keys(){return this[W].toArray().map((e=>e.key))}values(){return this[W].toArray().map((e=>e.value))}reset(){this[X]&&this[W]&&this[W].length&&this[W].forEach((e=>this[X](e.key,e.value))),this[Y]=new Map,this[W]=new B,this[G]=0}dump(){return this[W].map((e=>!oe(this,e)&&{k:e.key,v:e.value,e:e.now+(e.maxAge||0)})).toArray().filter((e=>e))}dumpLru(){return this[W]}set(e,t,n){if((n=n||this[K])&&"number"!=typeof n)throw new TypeError("maxAge must be a number");const o=n?Date.now():0,r=this[H](t,e);if(this[Y].has(e)){if(r>this[$])return ae(this,this[Y].get(e)),!1;const a=this[Y].get(e).value;return this[X]&&(this[Z]||this[X](e,a.value)),a.now=o,a.maxAge=n,a.value=t,this[G]+=r-a.length,a.length=r,this.get(e),re(this),!0}const a=new ie(e,t,r,o,n);return a.length>this[$]?(this[X]&&this[X](e,t),!1):(this[G]+=a.length,this[W].unshift(a),this[Y].set(e,this[W].head),re(this),!0)}has(e){if(!this[Y].has(e))return!1;const t=this[Y].get(e).value;return!oe(this,t)}get(e){return ne(this,e,!0)}peek(e){return ne(this,e,!1)}pop(){const e=this[W].tail;return e?(ae(this,e),e.value):null}del(e){ae(this,this[Y].get(e))}load(e){this.reset();const t=Date.now();for(let n=e.length-1;n>=0;n--){const o=e[n],r=o.e||0;if(0===r)this.set(o.k,o.v);else{const e=r-t;e>0&&this.set(o.k,o.v,e)}}}prune(){this[Y].forEach(((e,t)=>ne(this,t,!1)))}};var ce=class{constructor({document:e}){this.document=e,this.cache=new le({max:10})}getProcessed(e){return this.cache.get(e)}setProcessed(e,t){this.cache.set(e,t)}};const{isArray:de,isObject:ue,isString:pe}=N,{asArray:he}=E,{prependBase:fe}=P;var ve=class{constructor({sharedCache:e}){this.perOpCache=new Map,this.sharedCache=e}async resolve({activeCtx:e,context:t,documentLoader:n,base:o,cycles:r=new Set}){t&&ue(t)&&t["@context"]&&(t=t["@context"]),t=he(t);const a=[];for(const i of t){if(pe(i)){let t=this._get(i);t||(t=await this._resolveRemoteContext({activeCtx:e,url:i,documentLoader:n,base:o,cycles:r})),de(t)?a.push(...t):a.push(t);continue}if(null===i){a.push(new ce({document:null}));continue}ue(i)||ge(t);const s=JSON.stringify(i);let l=this._get(s);l||(l=new ce({document:i}),this._cacheResolvedContext({key:s,resolved:l,tag:"static"})),a.push(l)}return a}_get(e){let t=this.perOpCache.get(e);if(!t){const n=this.sharedCache.get(e);n&&(t=n.get("static"),t&&this.perOpCache.set(e,t))}return t}_cacheResolvedContext({key:e,resolved:t,tag:n}){if(this.perOpCache.set(e,t),void 0!==n){let o=this.sharedCache.get(e);o||(o=new Map,this.sharedCache.set(e,o)),o.set(n,t)}return t}async _resolveRemoteContext({activeCtx:e,url:t,documentLoader:n,base:o,cycles:r}){t=fe(o,t);const{context:a,remoteDoc:i}=await this._fetchContext({activeCtx:e,url:t,documentLoader:n,cycles:r});ye({context:a,base:o=i.documentUrl||t});const s=await this.resolve({activeCtx:e,context:a,documentLoader:n,base:o,cycles:r});return this._cacheResolvedContext({key:t,resolved:s,tag:i.tag}),s}async _fetchContext({activeCtx:e,url:t,documentLoader:n,cycles:o}){if(o.size>10)throw new k("Maximum number of @context URLs exceeded.","jsonld.ContextUrlError",{code:"json-ld-1.0"===e.processingMode?"loading remote context failed":"context overflow",max:10});if(o.has(t))throw new k("Cyclical @context URLs detected.","jsonld.ContextUrlError",{code:"json-ld-1.0"===e.processingMode?"recursive context inclusion":"context overflow",url:t});let r,a;o.add(t);try{a=await n(t),r=a.document||null,pe(r)&&(r=JSON.parse(r))}catch(e){throw new k("Dereferencing a URL did not result in a valid JSON-LD object. Possible causes are an inaccessible URL perhaps due to a same-origin policy (ensure the server uses CORS if you are using client-side JavaScript), too many redirects, a non-JSON response, or more than one HTTP Link Header was provided for a remote context.","jsonld.InvalidUrl",{code:"loading remote context failed",url:t,cause:e})}if(!ue(r))throw new k("Dereferencing a URL did not result in a JSON object. The response was valid JSON, but it was not a JSON object.","jsonld.InvalidUrl",{code:"invalid remote context",url:t});return r="@context"in r?{"@context":r["@context"]}:{"@context":{}},a.contextUrl&&(de(r["@context"])||(r["@context"]=[r["@context"]]),r["@context"].push(a.contextUrl)),{context:r,remoteDoc:a}}};function ge(e){throw new k("Invalid JSON-LD syntax; @context must be an object.","jsonld.SyntaxError",{code:"invalid local context",context:e})}function ye({context:e,base:t}){if(!e)return;const n=e["@context"];if(pe(n))e["@context"]=fe(t,n);else if(de(n))for(let e=0;e<n.length;++e){const o=n[e];pe(o)?n[e]=fe(t,o):ue(o)&&ye({context:{"@context":o},base:t})}else if(ue(n))for(const e in n)ye({context:n[e],base:t})}var me=j.NQuads;const{isArray:xe,isObject:be,isString:we,isUndefined:je}=N,{isAbsolute:Ie,isRelative:Ne,prependBase:Se}=P,{asArray:Oe,compareShortestLeast:ke}=E,Ce=new Map,Le=/^@[a-zA-Z]+$/,Ae={};var De=Ae;function Te(e,t,n,o,r,a){if(null===t||!we(t)||Ae.isKeyword(t))return t;if(t.match(Le))return null;if(o&&o.hasOwnProperty(t)&&!0!==r.get(t)&&Ae.createTermDefinition({activeCtx:e,localCtx:o,term:t,defined:r,options:a}),(n=n||{}).vocab){const n=e.mappings.get(t);if(null===n)return null;if(be(n)&&"@id"in n)return n["@id"]}const i=t.indexOf(":");if(i>0){const n=t.substr(0,i),s=t.substr(i+1);if("_"===n||0===s.indexOf("//"))return t;o&&o.hasOwnProperty(n)&&Ae.createTermDefinition({activeCtx:e,localCtx:o,term:n,defined:r,options:a});const l=e.mappings.get(n);if(l&&l._prefix)return l["@id"]+s;if(Ie(t))return t}if(n.vocab&&"@vocab"in e)return e["@vocab"]+t;if(n.base&&"@base"in e){if(e["@base"])return Se(Se(a.base,e["@base"]),t)}else if(n.base)return Se(a.base,t);return t}function Re(e,t){if(!e||"object"!=typeof e||!t||"object"!=typeof t)return e===t;const n=Array.isArray(e);if(n!==Array.isArray(t))return!1;if(n){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(!Re(e[n],t[n]))return!1;return!0}const o=Object.keys(e),r=Object.keys(t);if(o.length!==r.length)return!1;for(const n in e){let o=e[n],r=t[n];if("@container"===n&&Array.isArray(o)&&Array.isArray(r)&&(o=o.slice().sort(),r=r.slice().sort()),!Re(o,r))return!1}return!0}Ae.process=async({activeCtx:e,localCtx:t,options:n,propagate:o=!0,overrideProtected:r=!1,cycles:a=new Set})=>{be(t)&&"@context"in t&&xe(t["@context"])&&(t=t["@context"]);if(0===Oe(t).length)return e;const i=await n.contextResolver.resolve({activeCtx:e,context:t,documentLoader:n.documentLoader,base:n.base});be(i[0].document)&&"boolean"==typeof i[0].document["@propagate"]&&(o=i[0].document["@propagate"]);let s=e;o||s.previousContext||(s=s.clone(),s.previousContext=e);for(const o of i){let{document:i}=o;if(e=s,null===i){if(!r&&0!==Object.keys(e.protected).length){const r=n&&n.protectedMode||"error";if("error"===r)throw new k("Tried to nullify a context with protected terms outside of a term definition.","jsonld.SyntaxError",{code:"invalid context nullification"});if("warn"===r){console.warn("WARNING: invalid context nullification");const t=o.getProcessed(e);if(t){s=e=t;continue}const r=e;s=e=Ae.getInitialContext(n).clone();for(const[t,n]of Object.entries(r.protected))n&&(e.mappings[t]=E.clone(r.mappings[t]));e.protected=E.clone(r.protected),o.setProcessed(r,s);continue}throw new k("Invalid protectedMode.","jsonld.SyntaxError",{code:"invalid protected mode",context:t,protectedMode:r})}s=e=Ae.getInitialContext(n).clone();continue}const l=o.getProcessed(e);if(l){s=e=l;continue}if(be(i)&&"@context"in i&&(i=i["@context"]),!be(i))throw new k("Invalid JSON-LD syntax; @context must be an object.","jsonld.SyntaxError",{code:"invalid local context",context:i});s=s.clone();const c=new Map;if("@version"in i){if(1.1!==i["@version"])throw new k("Unsupported JSON-LD version: "+i["@version"],"jsonld.UnsupportedVersion",{code:"invalid @version value",context:i});if(e.processingMode&&"json-ld-1.0"===e.processingMode)throw new k("@version: "+i["@version"]+" not compatible with "+e.processingMode,"jsonld.ProcessingModeConflict",{code:"processing mode conflict",context:i});s.processingMode="json-ld-1.1",s["@version"]=i["@version"],c.set("@version",!0)}if(s.processingMode=s.processingMode||e.processingMode,"@base"in i){let e=i["@base"];if(null===e||Ie(e));else{if(!Ne(e))throw new k('Invalid JSON-LD syntax; the value of "@base" in a @context must be an absolute IRI, a relative IRI, or null.',"jsonld.SyntaxError",{code:"invalid base IRI",context:i});e=Se(s["@base"],e)}s["@base"]=e,c.set("@base",!0)}if("@vocab"in i){const e=i["@vocab"];if(null===e)delete s["@vocab"];else{if(!we(e))throw new k('Invalid JSON-LD syntax; the value of "@vocab" in a @context must be a string or null.',"jsonld.SyntaxError",{code:"invalid vocab mapping",context:i});if(!Ie(e)&&Ae.processingMode(s,1))throw new k('Invalid JSON-LD syntax; the value of "@vocab" in a @context must be an absolute IRI.',"jsonld.SyntaxError",{code:"invalid vocab mapping",context:i});s["@vocab"]=Te(s,e,{vocab:!0,base:!0},void 0,void 0,n)}c.set("@vocab",!0)}if("@language"in i){const e=i["@language"];if(null===e)delete s["@language"];else{if(!we(e))throw new k('Invalid JSON-LD syntax; the value of "@language" in a @context must be a string or null.',"jsonld.SyntaxError",{code:"invalid default language",context:i});s["@language"]=e.toLowerCase()}c.set("@language",!0)}if("@direction"in i){const t=i["@direction"];if("json-ld-1.0"===e.processingMode)throw new k("Invalid JSON-LD syntax; @direction not compatible with "+e.processingMode,"jsonld.SyntaxError",{code:"invalid context member",context:i});if(null===t)delete s["@direction"];else{if("ltr"!==t&&"rtl"!==t)throw new k('Invalid JSON-LD syntax; the value of "@direction" in a @context must be null, "ltr", or "rtl".',"jsonld.SyntaxError",{code:"invalid base direction",context:i});s["@direction"]=t}c.set("@direction",!0)}if("@propagate"in i){const n=i["@propagate"];if("json-ld-1.0"===e.processingMode)throw new k("Invalid JSON-LD syntax; @propagate not compatible with "+e.processingMode,"jsonld.SyntaxError",{code:"invalid context entry",context:i});if("boolean"!=typeof n)throw new k("Invalid JSON-LD syntax; @propagate value must be a boolean.","jsonld.SyntaxError",{code:"invalid @propagate value",context:t});c.set("@propagate",!0)}if("@import"in i){const o=i["@import"];if("json-ld-1.0"===e.processingMode)throw new k("Invalid JSON-LD syntax; @import not compatible with "+e.processingMode,"jsonld.SyntaxError",{code:"invalid context entry",context:i});if(!we(o))throw new k("Invalid JSON-LD syntax; @import must be a string.","jsonld.SyntaxError",{code:"invalid @import value",context:t});const r=await n.contextResolver.resolve({activeCtx:e,context:o,documentLoader:n.documentLoader,base:n.base});if(1!==r.length)throw new k("Invalid JSON-LD syntax; @import must reference a single context.","jsonld.SyntaxError",{code:"invalid remote context",context:t});const a=r[0].getProcessed(e);if(a)i=a;else{const n=r[0].document;if("@import"in n)throw new k("Invalid JSON-LD syntax: imported context must not include @import.","jsonld.SyntaxError",{code:"invalid context entry",context:t});for(const e in n)i.hasOwnProperty(e)||(i[e]=n[e]);r[0].setProcessed(e,i)}c.set("@import",!0)}c.set("@protected",i["@protected"]||!1);for(const e in i)if(Ae.createTermDefinition({activeCtx:s,localCtx:i,term:e,defined:c,options:n,overrideProtected:r}),be(i[e])&&"@context"in i[e]){const t=i[e]["@context"];let o=!0;if(we(t)){const e=Se(n.base,t);a.has(e)?o=!1:a.add(e)}if(o)try{await Ae.process({activeCtx:s.clone(),localCtx:i[e]["@context"],overrideProtected:!0,options:n,cycles:a})}catch(t){throw new k("Invalid JSON-LD syntax; invalid scoped context.","jsonld.SyntaxError",{code:"invalid scoped context",context:i[e]["@context"],term:e})}}o.setProcessed(e,s)}return s},Ae.createTermDefinition=({activeCtx:e,localCtx:t,term:n,defined:o,options:r,overrideProtected:a=!1})=>{if(o.has(n)){if(o.get(n))return;throw new k("Cyclical context definition detected.","jsonld.CyclicalContext",{code:"cyclic IRI mapping",context:t,term:n})}let i;if(o.set(n,!1),t.hasOwnProperty(n)&&(i=t[n]),"@type"===n&&be(i)&&"@set"===(i["@container"]||"@set")&&Ae.processingMode(e,1.1)){const e=["@container","@id","@protected"],o=Object.keys(i);if(0===o.length||o.some((t=>!e.includes(t))))throw new k("Invalid JSON-LD syntax; keywords cannot be overridden.","jsonld.SyntaxError",{code:"keyword redefinition",context:t,term:n})}else{if(Ae.isKeyword(n))throw new k("Invalid JSON-LD syntax; keywords cannot be overridden.","jsonld.SyntaxError",{code:"keyword redefinition",context:t,term:n});if(n.match(Le))return void console.warn('WARNING: terms beginning with "@" are reserved for future use and ignored',{term:n});if(""===n)throw new k("Invalid JSON-LD syntax; a term cannot be an empty string.","jsonld.SyntaxError",{code:"invalid term definition",context:t})}const s=e.mappings.get(n);e.mappings.has(n)&&e.mappings.delete(n);let l=!1;if((we(i)||null===i)&&(l=!0,i={"@id":i}),!be(i))throw new k("Invalid JSON-LD syntax; @context term values must be strings or objects.","jsonld.SyntaxError",{code:"invalid term definition",context:t});const c={};e.mappings.set(n,c),c.reverse=!1;const d=["@container","@id","@language","@reverse","@type"];Ae.processingMode(e,1.1)&&d.push("@context","@direction","@index","@nest","@prefix","@protected");for(const e in i)if(!d.includes(e))throw new k("Invalid JSON-LD syntax; a term definition must not contain "+e,"jsonld.SyntaxError",{code:"invalid term definition",context:t});const u=n.indexOf(":");if(c._termHasColon=u>0,"@reverse"in i){if("@id"in i)throw new k("Invalid JSON-LD syntax; a @reverse term definition must not contain @id.","jsonld.SyntaxError",{code:"invalid reverse property",context:t});if("@nest"in i)throw new k("Invalid JSON-LD syntax; a @reverse term definition must not contain @nest.","jsonld.SyntaxError",{code:"invalid reverse property",context:t});const a=i["@reverse"];if(!we(a))throw new k("Invalid JSON-LD syntax; a @context @reverse value must be a string.","jsonld.SyntaxError",{code:"invalid IRI mapping",context:t});if(!Ae.isKeyword(a)&&a.match(Le))return console.warn('WARNING: values beginning with "@" are reserved for future use and ignored',{reverse:a}),void(s?e.mappings.set(n,s):e.mappings.delete(n));const l=Te(e,a,{vocab:!0,base:!1},t,o,r);if(!Ie(l))throw new k("Invalid JSON-LD syntax; a @context @reverse value must be an absolute IRI or a blank node identifier.","jsonld.SyntaxError",{code:"invalid IRI mapping",context:t});c["@id"]=l,c.reverse=!0}else if("@id"in i){let a=i["@id"];if(a&&!we(a))throw new k("Invalid JSON-LD syntax; a @context @id value must be an array of strings or a string.","jsonld.SyntaxError",{code:"invalid IRI mapping",context:t});if(null===a)c["@id"]=null;else{if(!Ae.isKeyword(a)&&a.match(Le))return console.warn('WARNING: values beginning with "@" are reserved for future use and ignored',{id:a}),void(s?e.mappings.set(n,s):e.mappings.delete(n));if(a!==n){if(a=Te(e,a,{vocab:!0,base:!1},t,o,r),!Ie(a)&&!Ae.isKeyword(a))throw new k("Invalid JSON-LD syntax; a @context @id value must be an absolute IRI, a blank node identifier, or a keyword.","jsonld.SyntaxError",{code:"invalid IRI mapping",context:t});if(n.match(/(?::[^:])|\//)){if(Te(e,n,{vocab:!0,base:!1},t,new Map(o).set(n,!0),r)!==a)throw new k("Invalid JSON-LD syntax; term in form of IRI must expand to definition.","jsonld.SyntaxError",{code:"invalid IRI mapping",context:t})}c["@id"]=a,c._prefix=l&&!c._termHasColon&&a.match(/[:\/\?#\[\]@]$/)}}}if(!("@id"in c))if(c._termHasColon){const a=n.substr(0,u);if(t.hasOwnProperty(a)&&Ae.createTermDefinition({activeCtx:e,localCtx:t,term:a,defined:o,options:r}),e.mappings.has(a)){const t=n.substr(u+1);c["@id"]=e.mappings.get(a)["@id"]+t}else c["@id"]=n}else if("@type"===n)c["@id"]=n;else{if(!("@vocab"in e))throw new k("Invalid JSON-LD syntax; @context terms must define an @id.","jsonld.SyntaxError",{code:"invalid IRI mapping",context:t,term:n});c["@id"]=e["@vocab"]+n}if((!0===i["@protected"]||!0===o.get("@protected")&&!1!==i["@protected"])&&(e.protected[n]=!0,c.protected=!0),o.set(n,!0),"@type"in i){let n=i["@type"];if(!we(n))throw new k("Invalid JSON-LD syntax; an @context @type value must be a string.","jsonld.SyntaxError",{code:"invalid type mapping",context:t});if("@json"===n||"@none"===n){if(Ae.processingMode(e,1))throw new k(`Invalid JSON-LD syntax; an @context @type value must not be "${n}" in JSON-LD 1.0 mode.`,"jsonld.SyntaxError",{code:"invalid type mapping",context:t})}else if("@id"!==n&&"@vocab"!==n){if(n=Te(e,n,{vocab:!0,base:!1},t,o,r),!Ie(n))throw new k("Invalid JSON-LD syntax; an @context @type value must be an absolute IRI.","jsonld.SyntaxError",{code:"invalid type mapping",context:t});if(0===n.indexOf("_:"))throw new k("Invalid JSON-LD syntax; an @context @type value must be an IRI, not a blank node identifier.","jsonld.SyntaxError",{code:"invalid type mapping",context:t})}c["@type"]=n}if("@container"in i){const n=we(i["@container"])?[i["@container"]]:i["@container"]||[],o=["@list","@set","@index","@language"];let r=!0;const a=n.includes("@set");if(Ae.processingMode(e,1.1)){if(o.push("@graph","@id","@type"),n.includes("@list")){if(1!==n.length)throw new k("Invalid JSON-LD syntax; @context @container with @list must have no other values","jsonld.SyntaxError",{code:"invalid container mapping",context:t})}else if(n.includes("@graph")){if(n.some((e=>"@graph"!==e&&"@id"!==e&&"@index"!==e&&"@set"!==e)))throw new k("Invalid JSON-LD syntax; @context @container with @graph must have no other values other than @id, @index, and @set","jsonld.SyntaxError",{code:"invalid container mapping",context:t})}else r&=n.length<=(a?2:1);if(n.includes("@type")&&(c["@type"]=c["@type"]||"@id",!["@id","@vocab"].includes(c["@type"])))throw new k("Invalid JSON-LD syntax; container: @type requires @type to be @id or @vocab.","jsonld.SyntaxError",{code:"invalid type mapping",context:t})}else r&=!xe(i["@container"]),r&=n.length<=1;if(r&=n.every((e=>o.includes(e))),r&=!(a&&n.includes("@list")),!r)throw new k("Invalid JSON-LD syntax; @context @container value must be one of the following: "+o.join(", "),"jsonld.SyntaxError",{code:"invalid container mapping",context:t});if(c.reverse&&!n.every((e=>["@index","@set"].includes(e))))throw new k("Invalid JSON-LD syntax; @context @container value for a @reverse type definition must be @index or @set.","jsonld.SyntaxError",{code:"invalid reverse property",context:t});c["@container"]=n}if("@index"in i){if(!("@container"in i)||!c["@container"].includes("@index"))throw new k(`Invalid JSON-LD syntax; @index without @index in @container: "${i["@index"]}" on term "${n}".`,"jsonld.SyntaxError",{code:"invalid term definition",context:t});if(!we(i["@index"])||0===i["@index"].indexOf("@"))throw new k(`Invalid JSON-LD syntax; @index must expand to an IRI: "${i["@index"]}" on term "${n}".`,"jsonld.SyntaxError",{code:"invalid term definition",context:t});c["@index"]=i["@index"]}if("@context"in i&&(c["@context"]=i["@context"]),"@language"in i&&!("@type"in i)){let e=i["@language"];if(null!==e&&!we(e))throw new k("Invalid JSON-LD syntax; @context @language value must be a string or null.","jsonld.SyntaxError",{code:"invalid language mapping",context:t});null!==e&&(e=e.toLowerCase()),c["@language"]=e}if("@prefix"in i){if(n.match(/:|\//))throw new k("Invalid JSON-LD syntax; @context @prefix used on a compact IRI term","jsonld.SyntaxError",{code:"invalid term definition",context:t});if(Ae.isKeyword(c["@id"]))throw new k("Invalid JSON-LD syntax; keywords may not be used as prefixes","jsonld.SyntaxError",{code:"invalid term definition",context:t});if("boolean"!=typeof i["@prefix"])throw new k("Invalid JSON-LD syntax; @context value for @prefix must be boolean","jsonld.SyntaxError",{code:"invalid @prefix value",context:t});c._prefix=!0===i["@prefix"]}if("@direction"in i){const e=i["@direction"];if(null!==e&&"ltr"!==e&&"rtl"!==e)throw new k('Invalid JSON-LD syntax; @direction value must be null, "ltr", or "rtl".',"jsonld.SyntaxError",{code:"invalid base direction",context:t});c["@direction"]=e}if("@nest"in i){const e=i["@nest"];if(!we(e)||"@nest"!==e&&0===e.indexOf("@"))throw new k("Invalid JSON-LD syntax; @context @nest value must be a string which is not a keyword other than @nest.","jsonld.SyntaxError",{code:"invalid @nest value",context:t});c["@nest"]=e}
// disallow aliasing @context and @preserve
const p=c["@id"];if("@context"===p||"@preserve"===p)throw new k("Invalid JSON-LD syntax; @context and @preserve cannot be aliased.","jsonld.SyntaxError",{code:"invalid keyword alias",context:t});if(s&&s.protected&&!a&&(e.protected[n]=!0,c.protected=!0,!Re(s,c))){const e=r&&r.protectedMode||"error";if("error"===e)throw new k(`Invalid JSON-LD syntax; tried to redefine "${n}" which is a protected term.`,"jsonld.SyntaxError",{code:"protected term redefinition",context:t,term:n});if("warn"===e)return void console.warn("WARNING: protected term redefinition",{term:n});throw new k("Invalid protectedMode.","jsonld.SyntaxError",{code:"invalid protected mode",context:t,term:n,protectedMode:e})}},Ae.expandIri=(e,t,n,o)=>Te(e,t,n,void 0,void 0,o),Ae.getInitialContext=e=>{const t=JSON.stringify({processingMode:e.processingMode}),n=Ce.get(t);if(n)return n;const o={processingMode:e.processingMode,mappings:new Map,inverse:null,getInverse:function(){const e=this;if(e.inverse)return e.inverse;const t=e.inverse={},n=e.fastCurieMap={},o={},i=(e["@language"]||"@none").toLowerCase(),s=e["@direction"],l=e.mappings,c=[...l.keys()].sort(ke);for(const e of c){const r=l.get(e);if(null===r)continue;let c=r["@container"]||"@none";if(c=[].concat(c).sort().join(""),null===r["@id"])continue;const d=Oe(r["@id"]);for(const l of d){let d=t[l];const u=Ae.isKeyword(l);if(d)u||r._termHasColon||o[l].push(e);else if(t[l]=d={},!u&&!r._termHasColon){o[l]=[e];const t={iri:l,terms:o[l]};l[0]in n?n[l[0]].push(t):n[l[0]]=[t]}if(d[c]||(d[c]={"@language":{},"@type":{},"@any":{}}),d=d[c],a(e,d["@any"],"@none"),r.reverse)a(e,d["@type"],"@reverse");else if("@none"===r["@type"])a(e,d["@any"],"@none"),a(e,d["@language"],"@none"),a(e,d["@type"],"@none");else if("@type"in r)a(e,d["@type"],r["@type"]);else if("@language"in r&&"@direction"in r){const t=r["@language"],n=r["@direction"];a(e,d["@language"],t&&n?`${t}_${n}`.toLowerCase():t?t.toLowerCase():n?`_${n}`:"@null")}else"@language"in r?a(e,d["@language"],(r["@language"]||"@null").toLowerCase()):"@direction"in r?r["@direction"]?a(e,d["@language"],`_${r["@direction"]}`):a(e,d["@language"],"@none"):s?(a(e,d["@language"],`_${s}`),a(e,d["@language"],"@none"),a(e,d["@type"],"@none")):(a(e,d["@language"],i),a(e,d["@language"],"@none"),a(e,d["@type"],"@none"))}}for(const e in n)r(n,e,1);return t},clone:function(){const e={};e.mappings=E.clone(this.mappings),e.clone=this.clone,e.inverse=null,e.getInverse=this.getInverse,e.protected=E.clone(this.protected),this.previousContext&&(e.previousContext=this.previousContext.clone());e.revertToPreviousContext=this.revertToPreviousContext,"@base"in this&&(e["@base"]=this["@base"]);"@language"in this&&(e["@language"]=this["@language"]);"@vocab"in this&&(e["@vocab"]=this["@vocab"]);return e},revertToPreviousContext:function(){if(!this.previousContext)return this;return this.previousContext.clone()},protected:{}};return 1e4===Ce.size&&Ce.clear(),Ce.set(t,o),o;function r(e,t,n){const o=e[t],a=e[t]={};let i,s;for(const e of o)i=e.iri,s=n>=i.length?"":i[n],s in a?a[s].push(e):a[s]=[e];for(const e in a)""!==e&&r(a,e,n+1)}function a(e,t,n){t.hasOwnProperty(n)||(t[n]=e)}},Ae.getContextValue=(e,t,n)=>{if(null===t){if("@context"===n)return;return null}if(e.mappings.has(t)){const o=e.mappings.get(t);if(je(n))return o;if(o.hasOwnProperty(n))return o[n]}return"@language"===n&&n in e||"@direction"===n&&n in e?e[n]:"@context"!==n?null:void 0},Ae.processingMode=(e,t)=>t.toString()>="1.1"?!e.processingMode||e.processingMode>="json-ld-"+t.toString():"json-ld-1.0"===e.processingMode,Ae.isKeyword=e=>{if(!we(e)||"@"!==e[0])return!1;switch(e){case"@base":case"@container":case"@context":case"@default":case"@direction":case"@embed":case"@explicit":case"@graph":case"@id":case"@included":case"@index":case"@json":case"@language":case"@list":case"@nest":case"@none":case"@omitDefault":case"@prefix":case"@preserve":case"@protected":case"@requireAll":case"@reverse":case"@set":case"@type":case"@value":case"@version":case"@vocab":return!0}return!1};const{isArray:Ee,isObject:_e,isEmptyObject:Me,isString:Pe,isUndefined:Je}=N,{isList:Be,isValue:Fe,isGraph:Ue,isSubject:qe}=O,{expandIri:Ve,getContextValue:ze,isKeyword:$e,process:Ge,processingMode:He}=De,{isAbsolute:Qe}=P,{addValue:Ke,asArray:Xe,getValues:Ze,validateTypeValue:We}=E,Ye={};var et=Ye;const tt=/^[a-zA-Z]{1,8}(-[a-zA-Z0-9]{1,8})*$/;async function nt({activeCtx:e,activeProperty:t,expandedActiveProperty:n,element:o,expandedParent:r,options:a={},insideList:i,typeKey:s,typeScopedContext:l,expansionMap:c}){const d=Object.keys(o).sort(),u=[];let p;const h=o[s]&&"@json"===Ve(e,Ee(o[s])?o[s][0]:o[s],{vocab:!0},a);for(const s of d){let d,f=o[s];if("@context"===s)continue;let v=Ve(e,s,{vocab:!0},a);if((null===v||!Qe(v)&&!$e(v))&&(v=c({unmappedProperty:s,activeCtx:e,activeProperty:t,parent:o,options:a,insideList:i,value:f,expandedParent:r}),void 0===v))continue;if($e(v)){if("@reverse"===n)throw new k("Invalid JSON-LD syntax; a keyword cannot be used as a @reverse property.","jsonld.SyntaxError",{code:"invalid reverse property map",value:f});if(v in r&&"@included"!==v&&"@type"!==v)throw new k("Invalid JSON-LD syntax; colliding keywords detected.","jsonld.SyntaxError",{code:"colliding keywords",keyword:v})}if("@id"===v){if(!Pe(f)){if(!a.isFrame)throw new k('Invalid JSON-LD syntax; "@id" value must a string.',"jsonld.SyntaxError",{code:"invalid @id value",value:f});if(_e(f)){if(!Me(f))throw new k('Invalid JSON-LD syntax; "@id" value an empty object or array of strings, if framing',"jsonld.SyntaxError",{code:"invalid @id value",value:f})}else{if(!Ee(f))throw new k('Invalid JSON-LD syntax; "@id" value an empty object or array of strings, if framing',"jsonld.SyntaxError",{code:"invalid @id value",value:f});if(!f.every((e=>Pe(e))))throw new k('Invalid JSON-LD syntax; "@id" value an empty object or array of strings, if framing',"jsonld.SyntaxError",{code:"invalid @id value",value:f})}}Ke(r,"@id",Xe(f).map((t=>Pe(t)?Ve(e,t,{base:!0},a):t)),{propertyIsArray:a.isFrame});continue}if("@type"===v){_e(f)&&(f=Object.fromEntries(Object.entries(f).map((([e,t])=>[Ve(l,e,{vocab:!0}),Xe(t).map((e=>Ve(l,e,{base:!0,vocab:!0})))])))),We(f,a.isFrame),Ke(r,"@type",Xe(f).map((e=>Pe(e)?Ve(l,e,{base:!0,vocab:!0},a):e)),{propertyIsArray:a.isFrame});continue}if("@included"===v&&He(e,1.1)){const n=Xe(await Ye.expand({activeCtx:e,activeProperty:t,element:f,options:a,expansionMap:c}));if(!n.every((e=>qe(e))))throw new k("Invalid JSON-LD syntax; values of @included must expand to node objects.","jsonld.SyntaxError",{code:"invalid @included value",value:f});Ke(r,"@included",n,{propertyIsArray:!0});continue}if("@graph"===v&&!_e(f)&&!Ee(f))throw new k('Invalid JSON-LD syntax; "@graph" value must not be an object or an array.',"jsonld.SyntaxError",{code:"invalid @graph value",value:f});if("@value"===v){p=f,h&&He(e,1.1)?r["@value"]=f:Ke(r,"@value",f,{propertyIsArray:a.isFrame});continue}if("@language"===v){if(null===f)continue;if(!Pe(f)&&!a.isFrame)throw new k('Invalid JSON-LD syntax; "@language" value must be a string.',"jsonld.SyntaxError",{code:"invalid language-tagged string",value:f});f=Xe(f).map((e=>Pe(e)?e.toLowerCase():e));for(const e of f)Pe(e)&&!e.match(tt)&&console.warn(`@language must be valid BCP47: ${e}`);Ke(r,"@language",f,{propertyIsArray:a.isFrame});continue}if("@direction"===v){if(!Pe(f)&&!a.isFrame)throw new k('Invalid JSON-LD syntax; "@direction" value must be a string.',"jsonld.SyntaxError",{code:"invalid base direction",value:f});f=Xe(f);for(const e of f)if(Pe(e)&&"ltr"!==e&&"rtl"!==e)throw new k('Invalid JSON-LD syntax; "@direction" must be "ltr" or "rtl".',"jsonld.SyntaxError",{code:"invalid base direction",value:f});Ke(r,"@direction",f,{propertyIsArray:a.isFrame});continue}if("@index"===v){if(!Pe(f))throw new k('Invalid JSON-LD syntax; "@index" value must be a string.',"jsonld.SyntaxError",{code:"invalid @index value",value:f});Ke(r,"@index",f);continue}if("@reverse"===v){if(!_e(f))throw new k('Invalid JSON-LD syntax; "@reverse" value must be an object.',"jsonld.SyntaxError",{code:"invalid @reverse value",value:f});if(d=await Ye.expand({activeCtx:e,activeProperty:"@reverse",element:f,options:a,expansionMap:c}),"@reverse"in d)for(const e in d["@reverse"])Ke(r,e,d["@reverse"][e],{propertyIsArray:!0});let t=r["@reverse"]||null;for(const e in d){if("@reverse"===e)continue;null===t&&(t=r["@reverse"]={}),Ke(t,e,[],{propertyIsArray:!0});const n=d[e];for(let o=0;o<n.length;++o){const r=n[o];if(Fe(r)||Be(r))throw new k('Invalid JSON-LD syntax; "@reverse" value must not be a @value or an @list.',"jsonld.SyntaxError",{code:"invalid reverse property value",value:d});Ke(t,e,r,{propertyIsArray:!0})}}continue}if("@nest"===v){u.push(s);continue}let g=e;const y=ze(e,s,"@context");Je(y)||(g=await Ge({activeCtx:e,localCtx:y,propagate:!0,overrideProtected:!0,options:a}));const m=ze(g,s,"@container")||[];if(m.includes("@language")&&_e(f)){d=rt(g,f,ze(g,s,"@direction"),a)}else if(m.includes("@index")&&_e(f)){const t=m.includes("@graph"),n=ze(g,s,"@index")||"@index",o="@index"!==n&&Ve(e,n,{vocab:!0},a);d=await at({activeCtx:g,options:a,activeProperty:s,value:f,expansionMap:c,asGraph:t,indexKey:n,propertyIndex:o})}else if(m.includes("@id")&&_e(f)){const e=m.includes("@graph");d=await at({activeCtx:g,options:a,activeProperty:s,value:f,expansionMap:c,asGraph:e,indexKey:"@id"})}else if(m.includes("@type")&&_e(f))d=await at({activeCtx:g.revertToPreviousContext(),options:a,activeProperty:s,value:f,expansionMap:c,asGraph:!1,indexKey:"@type"});else{const o="@list"===v;if(o||"@set"===v){let e=t;o&&"@graph"===n&&(e=null),d=await Ye.expand({activeCtx:g,activeProperty:e,element:f,options:a,insideList:o,expansionMap:c})}else d="@json"===ze(e,s,"@type")?{"@type":"@json","@value":f}:await Ye.expand({activeCtx:g,activeProperty:s,element:f,options:a,insideList:!1,expansionMap:c})}if(null!==d||"@value"===v||(d=c({unmappedValue:f,expandedProperty:v,activeCtx:g,activeProperty:t,parent:o,options:a,insideList:i,key:s,expandedParent:r}),void 0!==d))if("@list"!==v&&!Be(d)&&m.includes("@list")&&(d={"@list":Xe(d)}),m.includes("@graph")&&!m.some((e=>"@id"===e||"@index"===e))&&(d=Xe(d).map((e=>({"@graph":Xe(e)})))),g.mappings.has(s)&&g.mappings.get(s).reverse){const e=r["@reverse"]=r["@reverse"]||{};d=Xe(d);for(let t=0;t<d.length;++t){const n=d[t];if(Fe(n)||Be(n))throw new k('Invalid JSON-LD syntax; "@reverse" value must not be a @value or an @list.',"jsonld.SyntaxError",{code:"invalid reverse property value",value:d});Ke(e,v,n,{propertyIsArray:!0})}}else Ke(r,v,d,{propertyIsArray:!0})}if("@value"in r)if("@json"===r["@type"]&&He(e,1.1));else if((_e(p)||Ee(p))&&!a.isFrame)throw new k('Invalid JSON-LD syntax; "@value" value must not be an object or an array.',"jsonld.SyntaxError",{code:"invalid value object value",value:p});for(const d of u){const u=Ee(o[d])?o[d]:[o[d]];for(const o of u){if(!_e(o)||Object.keys(o).some((t=>"@value"===Ve(e,t,{vocab:!0},a))))throw new k("Invalid JSON-LD syntax; nested value must be a node object.","jsonld.SyntaxError",{code:"invalid @nest value",value:o});await nt({activeCtx:e,activeProperty:t,expandedActiveProperty:n,element:o,expandedParent:r,options:a,insideList:i,typeScopedContext:l,typeKey:s,expansionMap:c})}}}function ot({activeCtx:e,activeProperty:t,value:n,options:o}){if(null==n)return null;const r=Ve(e,t,{vocab:!0},o);if("@id"===r)return Ve(e,n,{base:!0},o);if("@type"===r)return Ve(e,n,{vocab:!0,base:!0},o);const a=ze(e,t,"@type");if(("@id"===a||"@graph"===r)&&Pe(n))return{"@id":Ve(e,n,{base:!0},o)};if("@vocab"===a&&Pe(n))return{"@id":Ve(e,n,{vocab:!0,base:!0},o)};if($e(r))return n;const i={};if(a&&!["@id","@vocab","@none"].includes(a))i["@type"]=a;else if(Pe(n)){const n=ze(e,t,"@language");null!==n&&(i["@language"]=n);const o=ze(e,t,"@direction");null!==o&&(i["@direction"]=o)}return["boolean","number","string"].includes(typeof n)||(n=n.toString()),i["@value"]=n,i}function rt(e,t,n,o){const r=[],a=Object.keys(t).sort();for(const i of a){const a=Ve(e,i,{vocab:!0},o);let s=t[i];Ee(s)||(s=[s]);for(const e of s){if(null===e)continue;if(!Pe(e))throw new k("Invalid JSON-LD syntax; language map values must be strings.","jsonld.SyntaxError",{code:"invalid language map value",languageMap:t});const o={"@value":e};"@none"!==a&&(o["@language"]=i.toLowerCase()),n&&(o["@direction"]=n),r.push(o)}}return r}async function at({activeCtx:e,options:t,activeProperty:n,value:o,expansionMap:r,asGraph:a,indexKey:i,propertyIndex:s}){const l=[],c=Object.keys(o).sort(),d="@type"===i;for(let u of c){if(d){const n=ze(e,u,"@context");Je(n)||(e=await Ge({activeCtx:e,localCtx:n,propagate:!1,options:t}))}let c,p=o[u];Ee(p)||(p=[p]),p=await Ye.expand({activeCtx:e,activeProperty:n,element:p,options:t,insideList:!1,insideIndex:!0,expansionMap:r}),c=s?"@none"===u?"@none":ot({activeCtx:e,activeProperty:i,value:u,options:t}):Ve(e,u,{vocab:!0},t),"@id"===i?u=Ve(e,u,{base:!0},t):d&&(u=c);for(let e of p){if(a&&!Ue(e)&&(e={"@graph":[e]}),"@type"===i)"@none"===c||(e["@type"]?e["@type"]=[u].concat(e["@type"]):e["@type"]=[u]);else{if(Fe(e)&&!["@language","@type","@index"].includes(i))throw new k(`Invalid JSON-LD syntax; Attempt to add illegal key to value object: "${i}".`,"jsonld.SyntaxError",{code:"invalid value object",value:e});s?"@none"!==c&&Ke(e,s,c,{propertyIsArray:!0,prependValue:!0}):"@none"===c||i in e||(e[i]=u)}l.push(e)}}return l}Ye.expand=async({activeCtx:e,activeProperty:t=null,element:n,options:o={},insideList:r=!1,insideIndex:a=!1,typeScopedContext:i=null,expansionMap:s=(()=>{})})=>{if(null==n)return null;if("@default"===t&&(o=Object.assign({},o,{isFrame:!1})),!Ee(n)&&!_e(n)){if(!r&&(null===t||"@graph"===Ve(e,t,{vocab:!0},o))){const a=await s({unmappedValue:n,activeCtx:e,activeProperty:t,options:o,insideList:r});return void 0===a?null:a}return ot({activeCtx:e,activeProperty:t,value:n,options:o})}if(Ee(n)){let l=[];const c=ze(e,t,"@container")||[];r=r||c.includes("@list");for(let c=0;c<n.length;++c){let d=await Ye.expand({activeCtx:e,activeProperty:t,element:n[c],options:o,expansionMap:s,insideIndex:a,typeScopedContext:i});r&&Ee(d)&&(d={"@list":d}),null===d&&(d=await s({unmappedValue:n[c],activeCtx:e,activeProperty:t,parent:n,index:c,options:o,expandedParent:l,insideList:r}),void 0===d)||(Ee(d)?l=l.concat(d):l.push(d))}return l}const l=Ve(e,t,{vocab:!0},o),c=ze(e,t,"@context");i=i||(e.previousContext?e:null);let d=Object.keys(n).sort(),u=!a;if(u&&i&&d.length<=2&&!d.includes("@context"))for(const t of d){const n=Ve(i,t,{vocab:!0},o);if("@value"===n){u=!1,e=i;break}if("@id"===n&&1===d.length){u=!1;break}}u&&(e=e.revertToPreviousContext()),Je(c)||(e=await Ge({activeCtx:e,localCtx:c,propagate:!0,overrideProtected:!0,options:o})),"@context"in n&&(e=await Ge({activeCtx:e,localCtx:n["@context"],options:o})),i=e;let p=null;for(const t of d){if("@type"===Ve(e,t,{vocab:!0},o)){p=p||t;const r=n[t],a=Array.isArray(r)?r.length>1?r.slice().sort():r:[r];for(const t of a){const n=ze(i,t,"@context");Je(n)||(e=await Ge({activeCtx:e,localCtx:n,options:o,propagate:!1}))}}}let h={};await nt({activeCtx:e,activeProperty:t,expandedActiveProperty:l,element:n,expandedParent:h,options:o,insideList:r,typeKey:p,typeScopedContext:i,expansionMap:s}),d=Object.keys(h);let f=d.length;if("@value"in h){if("@type"in h&&("@language"in h||"@direction"in h))throw new k('Invalid JSON-LD syntax; an element containing "@value" may not contain both "@type" and either "@language" or "@direction".',"jsonld.SyntaxError",{code:"invalid value object",element:h});let a=f-1;if("@type"in h&&(a-=1),"@index"in h&&(a-=1),"@language"in h&&(a-=1),"@direction"in h&&(a-=1),0!==a)throw new k('Invalid JSON-LD syntax; an element containing "@value" may only have an "@index" property and either "@type" or either or both "@language" or "@direction".',"jsonld.SyntaxError",{code:"invalid value object",element:h});const i=null===h["@value"]?[]:Xe(h["@value"]),l=Ze(h,"@type");if(He(e,1.1)&&l.includes("@json")&&1===l.length);else if(0===i.length){const a=await s({unmappedValue:h,activeCtx:e,activeProperty:t,element:n,options:o,insideList:r});h=void 0!==a?a:null}else{if(!i.every((e=>Pe(e)||Me(e)))&&"@language"in h)throw new k("Invalid JSON-LD syntax; only strings may be language-tagged.","jsonld.SyntaxError",{code:"invalid language-tagged value",element:h});if(!l.every((e=>Qe(e)&&!(Pe(e)&&0===e.indexOf("_:"))||Me(e))))throw new k('Invalid JSON-LD syntax; an element containing "@value" and "@type" must have an absolute IRI for the value of "@type".',"jsonld.SyntaxError",{code:"invalid typed value",element:h})}}else if("@type"in h&&!Ee(h["@type"]))h["@type"]=[h["@type"]];else if("@set"in h||"@list"in h){if(f>1&&(2!==f||!("@index"in h)))throw new k('Invalid JSON-LD syntax; if an element has the property "@set" or "@list", then it can have at most one other property that is "@index".',"jsonld.SyntaxError",{code:"invalid set or list object",element:h});"@set"in h&&(h=h["@set"],d=Object.keys(h),f=d.length)}else if(1===f&&"@language"in h){const a=await s(h,{unmappedValue:h,activeCtx:e,activeProperty:t,element:n,options:o,insideList:r});h=void 0!==a?a:null}if(_e(h)&&!o.keepFreeFloatingNodes&&!r&&(null===t||"@graph"===l)&&(0===f||"@value"in h||"@list"in h||1===f&&"@id"in h)){const a=await s({unmappedValue:h,activeCtx:e,activeProperty:t,element:n,options:o,insideList:r});h=void 0!==a?a:null}return h};const{isKeyword:it}=De,st={};var lt=st;st.createMergedNodeMap=(e,t)=>{const n=(t=t||{}).issuer||new E.IdentifierIssuer("_:b"),o={"@default":{}};return st.createNodeMap(e,o,"@default",n),st.mergeNodeMaps(o)},st.createNodeMap=(e,t,n,o,r,a)=>{if(N.isArray(e)){for(const r of e)st.createNodeMap(r,t,n,o,void 0,a);return}if(!N.isObject(e))return void(a&&a.push(e));if(O.isValue(e)){if("@type"in e){let t=e["@type"];0===t.indexOf("_:")&&(e["@type"]=t=o.getId(t))}return void(a&&a.push(e))}if(a&&O.isList(e)){const i=[];return st.createNodeMap(e["@list"],t,n,o,r,i),void a.push({"@list":i})}if("@type"in e){const t=e["@type"];for(const e of t)0===e.indexOf("_:")&&o.getId(e)}N.isUndefined(r)&&(r=O.isBlankNode(e)?o.getId(e["@id"]):e["@id"]),a&&a.push({"@id":r});const i=t[n],s=i[r]=i[r]||{};s["@id"]=r;const l=Object.keys(e).sort();for(let a of l){if("@id"===a)continue;if("@reverse"===a){const a={"@id":r},s=e["@reverse"];for(const e in s){const r=s[e];for(const s of r){let r=s["@id"];O.isBlankNode(s)&&(r=o.getId(r)),st.createNodeMap(s,t,n,o,r),E.addValue(i[r],e,a,{propertyIsArray:!0,allowDuplicate:!1})}}continue}if("@graph"===a){r in t||(t[r]={}),st.createNodeMap(e[a],t,r,o);continue}if("@included"===a){st.createNodeMap(e[a],t,n,o);continue}if("@type"!==a&&it(a)){if("@index"===a&&a in s&&(e[a]!==s[a]||e[a]["@id"]!==s[a]["@id"]))throw new k("Invalid JSON-LD syntax; conflicting @index property detected.","jsonld.SyntaxError",{code:"conflicting indexes",subject:s});s[a]=e[a];continue}const l=e[a];if(0===a.indexOf("_:")&&(a=o.getId(a)),0!==l.length)for(let e of l)if("@type"===a&&(e=0===e.indexOf("_:")?o.getId(e):e),O.isSubject(e)||O.isSubjectReference(e)){if("@id"in e&&!e["@id"])continue;const r=O.isBlankNode(e)?o.getId(e["@id"]):e["@id"];E.addValue(s,a,{"@id":r},{propertyIsArray:!0,allowDuplicate:!1}),st.createNodeMap(e,t,n,o,r)}else if(O.isValue(e))E.addValue(s,a,e,{propertyIsArray:!0,allowDuplicate:!1});else if(O.isList(e)){const i=[];st.createNodeMap(e["@list"],t,n,o,r,i),e={"@list":i},E.addValue(s,a,e,{propertyIsArray:!0,allowDuplicate:!1})}else st.createNodeMap(e,t,n,o,r),E.addValue(s,a,e,{propertyIsArray:!0,allowDuplicate:!1});else E.addValue(s,a,[],{propertyIsArray:!0})}},st.mergeNodeMapGraphs=e=>{const t={};for(const n of Object.keys(e).sort())for(const o of Object.keys(e[n]).sort()){const r=e[n][o];o in t||(t[o]={"@id":o});const a=t[o];for(const e of Object.keys(r).sort())if(it(e)&&"@type"!==e)a[e]=E.clone(r[e]);else for(const t of r[e])E.addValue(a,e,E.clone(t),{propertyIsArray:!0,allowDuplicate:!1})}return t},st.mergeNodeMaps=e=>{const t=e["@default"],n=Object.keys(e).sort();for(const o of n){if("@default"===o)continue;const n=e[o];let r=t[o];r?"@graph"in r||(r["@graph"]=[]):t[o]=r={"@id":o,"@graph":[]};const a=r["@graph"];for(const e of Object.keys(n).sort()){const t=n[e];O.isSubjectReference(t)||a.push(t)}}return t};const{isSubjectReference:ct}=O,{createMergedNodeMap:dt}=lt,ut={};var pt=ut;ut.flatten=e=>{const t=dt(e),n=[],o=Object.keys(t).sort();for(let e=0;e<o.length;++e){const r=t[o[e]];ct(r)||n.push(r)}return n};const ht="http://www.w3.org/1999/02/22-rdf-syntax-ns#",ft="http://www.w3.org/2001/XMLSchema#";var vt={LINK_HEADER_REL:"http://www.w3.org/ns/json-ld#context",LINK_HEADER_CONTEXT:"http://www.w3.org/ns/json-ld#context",RDF:ht,RDF_LIST:ht+"List",RDF_FIRST:ht+"first",RDF_REST:ht+"rest",RDF_NIL:ht+"nil",RDF_TYPE:ht+"type",RDF_PLAIN_LITERAL:ht+"PlainLiteral",RDF_XML_LITERAL:ht+"XMLLiteral",RDF_JSON_LITERAL:ht+"JSON",RDF_OBJECT:ht+"object",RDF_LANGSTRING:ht+"langString",XSD:ft,XSD_BOOLEAN:ft+"boolean",XSD_DOUBLE:ft+"double",XSD_INTEGER:ft+"integer",XSD_STRING:ft+"string"};const{RDF_LIST:gt,RDF_FIRST:yt,RDF_REST:mt,RDF_NIL:xt,RDF_TYPE:bt,RDF_JSON_LITERAL:wt,XSD_BOOLEAN:jt,XSD_DOUBLE:It,XSD_INTEGER:Nt,XSD_STRING:St}=vt,Ot=/^[a-zA-Z]{1,8}(-[a-zA-Z0-9]{1,8})*$/,kt={};var Ct=kt;function Lt(e,t,n){if(e.termType.endsWith("Node"))return{"@id":e.value};const o={"@value":e.value};if(e.language)o["@language"]=e.language;else{let r=e.datatype.value;if(r||(r=St),r===wt){r="@json";try{o["@value"]=JSON.parse(o["@value"])}catch(e){throw new k("JSON literal could not be parsed.","jsonld.InvalidJsonLiteral",{code:"invalid JSON literal",value:o["@value"],cause:e})}}if(t){if(r===jt)"true"===o["@value"]?o["@value"]=!0:"false"===o["@value"]&&(o["@value"]=!1);else if(N.isNumeric(o["@value"]))if(r===Nt){const e=parseInt(o["@value"],10);e.toFixed(0)===o["@value"]&&(o["@value"]=e)}else r===It&&(o["@value"]=parseFloat(o["@value"]));[jt,Nt,It,St].includes(r)||(o["@type"]=r)}else if("i18n-datatype"===n&&r.startsWith("https://www.w3.org/ns/i18n#")){const[,e,t]=r.split(/[#_]/);e.length>0&&(o["@language"]=e,e.match(Ot)||console.warn(`@language must be valid BCP47: ${e}`)),o["@direction"]=t}else r!==St&&(o["@type"]=r)}return o}kt.fromRDF=async(e,{useRdfType:t=!1,useNativeTypes:n=!1,rdfDirection:o=null})=>{const r={},a={"@default":r},i={};for(const s of e){const e="DefaultGraph"===s.graph.termType?"@default":s.graph.value;e in a||(a[e]={}),"@default"===e||e in r||(r[e]={"@id":e});const l=a[e],c=s.subject.value,d=s.predicate.value,u=s.object;c in l||(l[c]={"@id":c});const p=l[c],h=u.termType.endsWith("Node");if(h&&!(u.value in l)&&(l[u.value]={"@id":u.value}),d===bt&&!t&&h){E.addValue(p,"@type",u.value,{propertyIsArray:!0});continue}const f=Lt(u,n,o);if(E.addValue(p,d,f,{propertyIsArray:!0}),h)if(u.value===xt){const e=l[u.value];"usages"in e||(e.usages=[]),e.usages.push({node:p,property:d,value:f})}else u.value in i?i[u.value]=!1:i[u.value]={node:p,property:d,value:f}}for(const e in a){const t=a[e];if(!(xt in t))continue;const n=t[xt];if(n.usages){for(let e of n.usages){let n=e.node,o=e.property,r=e.value;const a=[],s=[];let l=Object.keys(n).length;for(;o===mt&&N.isObject(i[n["@id"]])&&N.isArray(n[yt])&&1===n[yt].length&&N.isArray(n[mt])&&1===n[mt].length&&(3===l||4===l&&N.isArray(n["@type"])&&1===n["@type"].length&&n["@type"][0]===gt)&&(a.push(n[yt][0]),s.push(n["@id"]),e=i[n["@id"]],n=e.node,o=e.property,r=e.value,l=Object.keys(n).length,O.isBlankNode(n)););delete r["@id"],r["@list"]=a.reverse();for(const e of s)delete t[e]}delete n.usages}}const s=[],l=Object.keys(r).sort();for(const e of l){const t=r[e];if(e in a){const n=t["@graph"]=[],o=a[e],r=Object.keys(o).sort();for(const e of r){const t=o[e];O.isSubjectReference(t)||n.push(t)}}O.isSubjectReference(t)||s.push(t)}return s};var At=function e(t){return null===t||"object"!=typeof t||null!=t.toJSON?JSON.stringify(t):Array.isArray(t)?"["+t.reduce(((t,n,o)=>t+(0===o?"":",")+e(void 0===n||"symbol"==typeof n?null:n)),"")+"]":"{"+Object.keys(t).sort().reduce(((n,o,r)=>{if(void 0===t[o]||"symbol"==typeof t[o])return n;return n+(0===n.length?"":",")+e(o)+":"+e(t[o])}),"")+"}"};const{createNodeMap:Dt}=lt,{isKeyword:Tt}=De,{RDF_FIRST:Rt,RDF_REST:Et,RDF_NIL:_t,RDF_TYPE:Mt,RDF_JSON_LITERAL:Pt,RDF_LANGSTRING:Jt,XSD_BOOLEAN:Bt,XSD_DOUBLE:Ft,XSD_INTEGER:Ut,XSD_STRING:qt}=vt,{isAbsolute:Vt}=P,zt={};var $t=zt;function Gt(e,t,n,o,r){const a=Object.keys(t).sort();for(const i of a){const a=t[i],s=Object.keys(a).sort();for(let t of s){const s=a[t];if("@type"===t)t=Mt;else if(Tt(t))continue;for(const a of s){const s={termType:i.startsWith("_:")?"BlankNode":"NamedNode",value:i};if(!Vt(i))continue;const l={termType:t.startsWith("_:")?"BlankNode":"NamedNode",value:t};if(!Vt(t))continue;if("BlankNode"===l.termType&&!r.produceGeneralizedRdf)continue;const c=Ht(a,o,e,n,r.rdfDirection);c&&e.push({subject:s,predicate:l,object:c,graph:n})}}}}function Ht(e,t,n,o,r){const a={};if(O.isValue(e)){a.termType="Literal",a.value=void 0,a.datatype={termType:"NamedNode"};let t=e["@value"];const n=e["@type"]||null;if("@json"===n)a.value=At(t),a.datatype.value=Pt;else if(N.isBoolean(t))a.value=t.toString(),a.datatype.value=n||Bt;else if(N.isDouble(t)||n===Ft)N.isDouble(t)||(t=parseFloat(t)),a.value=t.toExponential(15).replace(/(\d)0*e\+?/,"$1E"),a.datatype.value=n||Ft;else if(N.isNumber(t))a.value=t.toFixed(0),a.datatype.value=n||Ut;else if("i18n-datatype"===r&&"@direction"in e){const n="https://www.w3.org/ns/i18n#"+(e["@language"]||"")+`_${e["@direction"]}`;a.datatype.value=n,a.value=t}else"@language"in e?(a.value=t,a.datatype.value=n||Jt,a.language=e["@language"]):(a.value=t,a.datatype.value=n||qt)}else if(O.isList(e)){const i=function(e,t,n,o,r){const a={termType:"NamedNode",value:Rt},i={termType:"NamedNode",value:Et},s={termType:"NamedNode",value:_t},l=e.pop(),c=l?{termType:"BlankNode",value:t.getId()}:s;let d=c;for(const s of e){const e=Ht(s,t,n,o,r),l={termType:"BlankNode",value:t.getId()};n.push({subject:d,predicate:a,object:e,graph:o}),n.push({subject:d,predicate:i,object:l,graph:o}),d=l}if(l){const e=Ht(l,t,n,o,r);n.push({subject:d,predicate:a,object:e,graph:o}),n.push({subject:d,predicate:i,object:s,graph:o})}return c}(e["@list"],t,n,o,r);a.termType=i.termType,a.value=i.value}else{const t=N.isObject(e)?e["@id"]:e;a.termType=t.startsWith("_:")?"BlankNode":"NamedNode",a.value=t}return"NamedNode"!==a.termType||Vt(a.value)?a:null}zt.toRDF=(e,t)=>{const n=new E.IdentifierIssuer("_:b"),o={"@default":{}};Dt(e,o,"@default",n);const r=[],a=Object.keys(o).sort();for(const e of a){let a;if("@default"===e)a={termType:"DefaultGraph",value:""};else{if(!Vt(e))continue;a=e.startsWith("_:")?{termType:"BlankNode"}:{termType:"NamedNode"},a.value=e}Gt(r,o[e],a,n,t)}return r};const{isKeyword:Qt}=De,{createNodeMap:Kt,mergeNodeMapGraphs:Xt}=lt,Zt={};var Wt=Zt;function Yt(e){const t={};for(const n in e)void 0!==e[n]&&(t["@"+n]=[e[n]]);return[t]}function en(e,t,n){for(let o=n.length-1;o>=0;--o){const r=n[o];if(r.graph===t&&r.subject["@id"]===e["@id"])return!0}return!1}function tn(e,t,n){const o="@"+n;let r=o in e?e[o][0]:t[n];if("embed"===n)if(!0===r)r="@once";else if(!1===r)r="@never";else if("@always"!==r&&"@never"!==r&&"@link"!==r&&"@first"!==r&&"@last"!==r&&"@once"!==r)throw new k("Invalid JSON-LD syntax; invalid value of @embed.","jsonld.SyntaxError",{code:"invalid @embed value",frame:e});return r}function nn(e){if(!N.isArray(e)||1!==e.length||!N.isObject(e[0]))throw new k("Invalid JSON-LD syntax; a JSON-LD frame must be a single object.","jsonld.SyntaxError",{frame:e});if("@id"in e[0])for(const t of E.asArray(e[0]["@id"]))if(!N.isObject(t)&&!P.isAbsolute(t)||N.isString(t)&&0===t.indexOf("_:"))throw new k("Invalid JSON-LD syntax; invalid @id in frame.","jsonld.SyntaxError",{code:"invalid frame",frame:e});if("@type"in e[0])for(const t of E.asArray(e[0]["@type"]))if(!N.isObject(t)&&!P.isAbsolute(t)||N.isString(t)&&0===t.indexOf("_:"))throw new k("Invalid JSON-LD syntax; invalid @type in frame.","jsonld.SyntaxError",{code:"invalid frame",frame:e})}function on(e,t,n,o){let r=!0,a=!1;for(const i in n){let s=!1;const l=E.getValues(t,i),c=0===E.getValues(n,i).length;if("@id"===i){if(N.isEmptyObject(n["@id"][0]||{})?s=!0:n["@id"].length>=0&&(s=n["@id"].includes(l[0])),!o.requireAll)return s}else if("@type"===i){if(r=!1,c){if(l.length>0)return!1;s=!0}else if(1===n["@type"].length&&N.isEmptyObject(n["@type"][0]))s=l.length>0;else for(const e of n["@type"])s=!(!N.isObject(e)||!("@default"in e))||(s||l.some((t=>t===e)));if(!o.requireAll)return s}else{if(Qt(i))continue;{const t=E.getValues(n,i)[0];let a=!1;if(t&&(nn([t]),a="@default"in t),r=!1,0===l.length&&a)continue;if(l.length>0&&c)return!1;if(void 0===t){if(l.length>0)return!1;s=!0}else if(O.isList(t)){const n=t["@list"][0];if(O.isList(l[0])){const t=l[0]["@list"];O.isValue(n)?s=t.some((e=>cn(n,e))):(O.isSubject(n)||O.isSubjectReference(n))&&(s=t.some((t=>ln(e,n,t,o))))}}else s=O.isValue(t)?l.some((e=>cn(t,e))):O.isSubjectReference(t)?l.some((n=>ln(e,t,n,o))):!!N.isObject(t)&&l.length>0}}if(!s&&o.requireAll)return!1;a=a||s}return r||a}function rn(e,t){const n=e.uniqueEmbeds[e.graph],o=n[t],r=o.parent,a=o.property,i={"@id":t};if(N.isArray(r)){for(let e=0;e<r.length;++e)if(E.compareValues(r[e],i)){r[e]=i;break}}else{const e=N.isArray(r[a]);E.removeValue(r,a,i,{propertyIsArray:e}),E.addValue(r,a,i,{propertyIsArray:e})}const s=e=>{const t=Object.keys(n);for(const o of t)o in n&&N.isObject(n[o].parent)&&n[o].parent["@id"]===e&&(delete n[o],s(o))};s(t)}
/**
 * Removes the @preserve keywords from expanded result of framing.
 *
 * @param input the framed, framed output.
 * @param options the framing options used.
 *
 * @return the resulting output.
 */function an(e,t){if(N.isArray(e))return e.map((e=>an(e,t)));if(N.isObject(e)){
// remove @preserve
if("@preserve"in e)return e["@preserve"][0];if(O.isValue(e))return e;if(O.isList(e))return e["@list"]=an(e["@list"],t),e;if("@id"in e){const n=e["@id"];if(t.link.hasOwnProperty(n)){const o=t.link[n].indexOf(e);if(-1!==o)return t.link[n][o];t.link[n].push(e)}else t.link[n]=[e]}for(const n in e)"@id"===n&&t.bnodesToClear.includes(e[n])?delete e["@id"]:e[n]=an(e[n],t)}return e}function sn(e,t,n){N.isObject(e)?E.addValue(e,t,n,{propertyIsArray:!0}):e.push(n)}function ln(e,t,n,o){if(!("@id"in n))return!1;const r=e.subjects[n["@id"]];return r&&on(e,r,t,o)}function cn(e,t){const n=t["@value"],o=t["@type"],r=t["@language"],a=e["@value"]?N.isArray(e["@value"])?e["@value"]:[e["@value"]]:[],i=e["@type"]?N.isArray(e["@type"])?e["@type"]:[e["@type"]]:[],s=e["@language"]?N.isArray(e["@language"])?e["@language"]:[e["@language"]]:[];return 0===a.length&&0===i.length&&0===s.length||!(!a.includes(n)&&!N.isEmptyObject(a[0]))&&(!!(!o&&0===i.length||i.includes(o)||o&&N.isEmptyObject(i[0]))&&!!(!r&&0===s.length||s.includes(r)||r&&N.isEmptyObject(s[0])))}Zt.frameMergedOrDefault=(e,t,n)=>{const o={options:n,embedded:!1,graph:"@default",graphMap:{"@default":{}},subjectStack:[],link:{},bnodeMap:{}},r=new E.IdentifierIssuer("_:b");Kt(e,o.graphMap,"@default",r),n.merged&&(o.graphMap["@merged"]=Xt(o.graphMap),o.graph="@merged"),o.subjects=o.graphMap[o.graph];const a=[];return Zt.frame(o,Object.keys(o.subjects).sort(),t,a),n.pruneBlankNodeIdentifiers&&(n.bnodesToClear=Object.keys(o.bnodeMap).filter((e=>1===o.bnodeMap[e].length))),
// remove @preserve from results
n.link={},an(a,n)},Zt.frame=(e,t,n,o,r=null)=>{nn(n),n=n[0];const a=e.options,i={embed:tn(n,a,"embed"),explicit:tn(n,a,"explicit"),requireAll:tn(n,a,"requireAll")};e.link.hasOwnProperty(e.graph)||(e.link[e.graph]={});const s=e.link[e.graph],l=function(e,t,n,o){const r={};for(const a of t){const t=e.graphMap[e.graph][a];on(e,t,n,o)&&(r[a]=t)}return r}(e,t,n,i),c=Object.keys(l).sort();for(const d of c){const c=l[d];if(null===r?e.uniqueEmbeds={[e.graph]:{}}:e.uniqueEmbeds[e.graph]=e.uniqueEmbeds[e.graph]||{},"@link"===i.embed&&d in s){sn(o,r,s[d]);continue}const u={"@id":d};if(0===d.indexOf("_:")&&E.addValue(e.bnodeMap,d,u,{propertyIsArray:!0}),s[d]=u,("@first"===i.embed||"@last"===i.embed)&&e.is11)throw new k("Invalid JSON-LD syntax; invalid value of @embed.","jsonld.SyntaxError",{code:"invalid @embed value",frame:n});if(e.embedded||!e.uniqueEmbeds[e.graph].hasOwnProperty(d))if(!e.embedded||"@never"!==i.embed&&!en(c,e.graph,e.subjectStack))if(!e.embedded||"@first"!=i.embed&&"@once"!=i.embed||!e.uniqueEmbeds[e.graph].hasOwnProperty(d)){if("@last"===i.embed&&d in e.uniqueEmbeds[e.graph]&&rn(e,d),e.uniqueEmbeds[e.graph][d]={parent:o,property:r},e.subjectStack.push({subject:c,graph:e.graph}),d in e.graphMap){let t=!1,o=null;"@graph"in n?(o=n["@graph"][0],t=!("@merged"===d||"@default"===d),N.isObject(o)||(o={})):(t="@merged"!==e.graph,o={}),t&&Zt.frame({...e,graph:d,embedded:!1},Object.keys(e.graphMap[d]).sort(),[o],u,"@graph")}"@included"in n&&Zt.frame({...e,embedded:!1},t,n["@included"],u,"@included");for(const t of Object.keys(c).sort())if(Qt(t)){if(u[t]=E.clone(c[t]),"@type"===t)for(const t of c["@type"])0===t.indexOf("_:")&&E.addValue(e.bnodeMap,t,u,{propertyIsArray:!0})}else if(!i.explicit||t in n)for(const o of c[t]){const r=t in n?n[t]:Yt(i);if(O.isList(o)){const r=n[t]&&n[t][0]&&n[t][0]["@list"]?n[t][0]["@list"]:Yt(i),a={"@list":[]};sn(u,t,a);const s=o["@list"];for(const t of s)O.isSubjectReference(t)?Zt.frame({...e,embedded:!0},[t["@id"]],r,a,"@list"):sn(a,"@list",E.clone(t))}else O.isSubjectReference(o)?Zt.frame({...e,embedded:!0},[o["@id"]],r,u,t):cn(r[0],o)&&sn(u,t,E.clone(o))}for(const e of Object.keys(n).sort()){if("@type"===e){if(!N.isObject(n[e][0])||!("@default"in n[e][0]))continue}else if(Qt(e))continue;const t=n[e][0]||{};if(!tn(t,a,"omitDefault")&&!(e in u)){let n="@null";"@default"in t&&(n=E.clone(t["@default"])),N.isArray(n)||(n=[n]),u[e]=[{"@preserve":n}]}}for(const t of Object.keys(n["@reverse"]||{}).sort()){const o=n["@reverse"][t];for(const n of Object.keys(e.subjects)){E.getValues(e.subjects[n],t).some((e=>e["@id"]===d))&&(u["@reverse"]=u["@reverse"]||{},E.addValue(u["@reverse"],t,[],{propertyIsArray:!0}),Zt.frame({...e,embedded:!0},[n],o,u["@reverse"][t],r))}}sn(o,r,u),e.subjectStack.pop()}else sn(o,r,u);else sn(o,r,u)}},Zt.cleanupNull=(e,t)=>{if(N.isArray(e)){return e.map((e=>Zt.cleanupNull(e,t))).filter((e=>e))}if("@null"===e)return null;if(N.isObject(e)){if("@id"in e){const n=e["@id"];if(t.link.hasOwnProperty(n)){const o=t.link[n].indexOf(e);if(-1!==o)return t.link[n][o];t.link[n].push(e)}else t.link[n]=[e]}for(const n in e)e[n]=Zt.cleanupNull(e[n],t)}return e};const{isArray:dn,isObject:un,isString:pn,isUndefined:hn}=N,{isList:fn,isValue:vn,isGraph:gn,isSimpleGraph:yn,isSubjectReference:mn}=O,{expandIri:xn,getContextValue:bn,isKeyword:wn,process:jn,processingMode:In}=De,{removeBase:Nn,prependBase:Sn}=P,{addValue:On,asArray:kn,compareShortestLeast:Cn}=E,Ln={};var An=Ln;function Dn(e,t,n){if("@nest"!==xn(e,t,{vocab:!0},n))throw new k("JSON-LD compact error; nested property must have an @nest value resolving to @nest.","jsonld.SyntaxError",{code:"invalid @nest value"})}Ln.compact=async({activeCtx:e,activeProperty:t=null,element:n,options:o={},compactionMap:r=(()=>{})})=>{if(dn(n)){let a=[];for(let i=0;i<n.length;++i){let s=await Ln.compact({activeCtx:e,activeProperty:t,element:n[i],options:o,compactionMap:r});null===s&&(s=await r({unmappedValue:n[i],activeCtx:e,activeProperty:t,parent:n,index:i,options:o}),void 0===s)||a.push(s)}if(o.compactArrays&&1===a.length){0===(bn(e,t,"@container")||[]).length&&(a=a[0])}return a}const a=bn(e,t,"@context");if(hn(a)||(e=await jn({activeCtx:e,localCtx:a,propagate:!0,overrideProtected:!0,options:o})),un(n)){if(o.link&&"@id"in n&&o.link.hasOwnProperty(n["@id"])){const e=o.link[n["@id"]];for(let t=0;t<e.length;++t)if(e[t].expanded===n)return e[t].compacted}if(vn(n)||mn(n)){const r=Ln.compactValue({activeCtx:e,activeProperty:t,value:n,options:o});return o.link&&mn(n)&&(o.link.hasOwnProperty(n["@id"])||(o.link[n["@id"]]=[]),o.link[n["@id"]].push({expanded:n,compacted:r})),r}if(fn(n)){if((bn(e,t,"@container")||[]).includes("@list"))return Ln.compact({activeCtx:e,activeProperty:t,element:n["@list"],options:o,compactionMap:r})}const a="@reverse"===t,i={},s=e;vn(n)||mn(n)||(e=e.revertToPreviousContext());const l=bn(s,t,"@context");hn(l)||(e=await jn({activeCtx:e,localCtx:l,propagate:!0,overrideProtected:!0,options:o})),o.link&&"@id"in n&&(o.link.hasOwnProperty(n["@id"])||(o.link[n["@id"]]=[]),o.link[n["@id"]].push({expanded:n,compacted:i}));let c=n["@type"]||[];c.length>1&&(c=Array.from(c).sort());const d=e;for(const t of c){const n=Ln.compactIri({activeCtx:d,iri:t,relativeTo:{vocab:!0}}),r=bn(s,n,"@context");hn(r)||(e=await jn({activeCtx:e,localCtx:r,options:o,propagate:!1}))}const u=Object.keys(n).sort();for(const l of u){const c=n[l];if("@id"!==l)if("@type"!==l)if("@reverse"!==l)if("@preserve"!==l)if("@index"!==l)if("@graph"!==l&&"@list"!==l&&"@included"!==l&&wn(l)){const t=Ln.compactIri({activeCtx:e,iri:l,relativeTo:{vocab:!0}});On(i,t,c)}else{if(!dn(c))throw new k("JSON-LD expansion error; expanded value must be an array.","jsonld.SyntaxError");if(0===c.length){const t=Ln.compactIri({activeCtx:e,iri:l,value:c,relativeTo:{vocab:!0},reverse:a}),n=e.mappings.has(t)?e.mappings.get(t)["@nest"]:null;let r=i;n&&(Dn(e,n,o),un(i[n])||(i[n]={}),r=i[n]),On(r,t,c,{propertyIsArray:!0})}for(const t of c){const n=Ln.compactIri({activeCtx:e,iri:l,value:t,relativeTo:{vocab:!0},reverse:a}),s=e.mappings.has(n)?e.mappings.get(n)["@nest"]:null;let c=i;s&&(Dn(e,s,o),un(i[s])||(i[s]={}),c=i[s]);const d=bn(e,n,"@container")||[],u=gn(t),p=fn(t);let h;p?h=t["@list"]:u&&(h=t["@graph"]);let f=await Ln.compact({activeCtx:e,activeProperty:n,element:p||u?h:t,options:o,compactionMap:r});if(p){if(dn(f)||(f=[f]),d.includes("@list")){On(c,n,f,{valueIsArray:!0,allowDuplicate:!0});continue}f={[Ln.compactIri({activeCtx:e,iri:"@list",relativeTo:{vocab:!0}})]:f},"@index"in t&&(f[Ln.compactIri({activeCtx:e,iri:"@index",relativeTo:{vocab:!0}})]=t["@index"])}if(u)if(d.includes("@graph")&&(d.includes("@id")||d.includes("@index")&&yn(t))){let r;c.hasOwnProperty(n)?r=c[n]:c[n]=r={};const a=(d.includes("@id")?t["@id"]:t["@index"])||Ln.compactIri({activeCtx:e,iri:"@none",relativeTo:{vocab:!0}});On(r,a,f,{propertyIsArray:!o.compactArrays||d.includes("@set")})}else d.includes("@graph")&&yn(t)?(dn(f)&&f.length>1&&(f={"@included":f}),On(c,n,f,{propertyIsArray:!o.compactArrays||d.includes("@set")})):(dn(f)&&1===f.length&&o.compactArrays&&(f=f[0]),f={[Ln.compactIri({activeCtx:e,iri:"@graph",relativeTo:{vocab:!0}})]:f},"@id"in t&&(f[Ln.compactIri({activeCtx:e,iri:"@id",relativeTo:{vocab:!0}})]=t["@id"]),"@index"in t&&(f[Ln.compactIri({activeCtx:e,iri:"@index",relativeTo:{vocab:!0}})]=t["@index"]),On(c,n,f,{propertyIsArray:!o.compactArrays||d.includes("@set")}));else if(d.includes("@language")||d.includes("@index")||d.includes("@id")||d.includes("@type")){let a,i;if(c.hasOwnProperty(n)?a=c[n]:c[n]=a={},d.includes("@language"))vn(f)&&(f=f["@value"]),i=t["@language"];else if(d.includes("@index")){const o=bn(e,n,"@index")||"@index",r=Ln.compactIri({activeCtx:e,iri:o,relativeTo:{vocab:!0}});if("@index"===o)i=t["@index"],delete f[r];else{let e;if([i,...e]=kn(f[o]||[]),pn(i))switch(e.length){case 0:delete f[o];break;case 1:f[o]=e[0];break;default:f[o]=e}else i=null}}else if(d.includes("@id")){const t=Ln.compactIri({activeCtx:e,iri:"@id",relativeTo:{vocab:!0}});i=f[t],delete f[t]}else if(d.includes("@type")){const a=Ln.compactIri({activeCtx:e,iri:"@type",relativeTo:{vocab:!0}});let s;switch([i,...s]=kn(f[a]||[]),s.length){case 0:delete f[a];break;case 1:f[a]=s[0];break;default:f[a]=s}1===Object.keys(f).length&&"@id"in t&&(f=await Ln.compact({activeCtx:e,activeProperty:n,element:{"@id":t["@id"]},options:o,compactionMap:r}))}i||(i=Ln.compactIri({activeCtx:e,iri:"@none",relativeTo:{vocab:!0}})),On(a,i,f,{propertyIsArray:d.includes("@set")})}else{const e=!o.compactArrays||d.includes("@set")||d.includes("@list")||dn(f)&&0===f.length||"@list"===l||"@graph"===l;On(c,n,f,{propertyIsArray:e})}}}else{if((bn(e,t,"@container")||[]).includes("@index"))continue;const n=Ln.compactIri({activeCtx:e,iri:l,relativeTo:{vocab:!0}});On(i,n,c)}else{const n=await Ln.compact({activeCtx:e,activeProperty:t,element:c,options:o,compactionMap:r});dn(n)&&0===n.length||On(i,l,n)}else{const t=await Ln.compact({activeCtx:e,activeProperty:"@reverse",element:c,options:o,compactionMap:r});for(const n in t)if(e.mappings.has(n)&&e.mappings.get(n).reverse){const r=t[n],a=(bn(e,n,"@container")||[]).includes("@set")||!o.compactArrays;On(i,n,r,{propertyIsArray:a}),delete t[n]}if(Object.keys(t).length>0){const n=Ln.compactIri({activeCtx:e,iri:l,relativeTo:{vocab:!0}});On(i,n,t)}}else{let t=kn(c).map((e=>Ln.compactIri({activeCtx:s,iri:e,relativeTo:{vocab:!0}})));1===t.length&&(t=t[0]);const n=Ln.compactIri({activeCtx:e,iri:"@type",relativeTo:{vocab:!0}}),o=(bn(e,n,"@container")||[]).includes("@set")&&In(e,1.1)||dn(t)&&0===c.length;On(i,n,t,{propertyIsArray:o})}else{let t=kn(c).map((t=>Ln.compactIri({activeCtx:e,iri:t,relativeTo:{vocab:!1},base:o.base})));1===t.length&&(t=t[0]);i[Ln.compactIri({activeCtx:e,iri:"@id",relativeTo:{vocab:!0}})]=t}}return i}return n},Ln.compactIri=({activeCtx:e,iri:t,value:n=null,relativeTo:o={vocab:!1},reverse:r=!1,base:a=null})=>{if(null===t)return t;e.isPropertyTermScoped&&e.previousContext&&(e=e.previousContext);const i=e.getInverse();if(wn(t)&&t in i&&"@none"in i[t]&&"@type"in i[t]["@none"]&&"@none"in i[t]["@none"]["@type"])return i[t]["@none"]["@type"]["@none"];if(o.vocab&&t in i){const o=e["@language"]||"@none",a=[];un(n)&&"@index"in n&&!("@graph"in n)&&a.push("@index","@index@set"),un(n)&&"@preserve"in n&&(n=n["@preserve"][0]),gn(n)?("@index"in n&&a.push("@graph@index","@graph@index@set","@index","@index@set"),"@id"in n&&a.push("@graph@id","@graph@id@set"),a.push("@graph","@graph@set","@set"),"@index"in n||a.push("@graph@index","@graph@index@set","@index","@index@set"),"@id"in n||a.push("@graph@id","@graph@id@set")):un(n)&&!vn(n)&&a.push("@id","@id@set","@type","@set@type");let i="@language",s="@null";if(r)i="@type",s="@reverse",a.push("@set");else if(fn(n)){"@index"in n||a.push("@list");const e=n["@list"];if(0===e.length)i="@any",s="@none";else{let t=0===e.length?o:null,n=null;for(let o=0;o<e.length;++o){const r=e[o];let a="@none",i="@none";if(vn(r))if("@direction"in r){a=`${(r["@language"]||"").toLowerCase()}_${r["@direction"]}`}else"@language"in r?a=r["@language"].toLowerCase():"@type"in r?i=r["@type"]:a="@null";else i="@id";if(null===t?t=a:a!==t&&vn(r)&&(t="@none"),null===n?n=i:i!==n&&(n="@none"),"@none"===t&&"@none"===n)break}t=t||"@none",n=n||"@none","@none"!==n?(i="@type",s=n):s=t}}else{if(vn(n))if("@language"in n&&!("@index"in n)){a.push("@language","@language@set"),s=n["@language"];const e=n["@direction"];e&&(s=`${s}_${e}`)}else"@direction"in n&&!("@index"in n)?s=`_${n["@direction"]}`:"@type"in n&&(i="@type",s=n["@type"]);else i="@type",s="@id";a.push("@set")}a.push("@none"),un(n)&&!("@index"in n)&&a.push("@index","@index@set"),vn(n)&&1===Object.keys(n).length&&a.push("@language","@language@set");const l=function(e,t,n,o,r,a){null===a&&(a="@null");const i=[];if(("@id"===a||"@reverse"===a)&&un(n)&&"@id"in n){"@reverse"===a&&i.push("@reverse");const t=Ln.compactIri({activeCtx:e,iri:n["@id"],relativeTo:{vocab:!0}});e.mappings.has(t)&&e.mappings.get(t)&&e.mappings.get(t)["@id"]===n["@id"]?i.push.apply(i,["@vocab","@id"]):i.push.apply(i,["@id","@vocab"])}else{i.push(a);const e=i.find((e=>e.includes("_")));e&&i.push(e.replace(/^[^_]+_/,"_"))}i.push("@none");const s=e.inverse[t];for(const e of o){if(!(e in s))continue;const t=s[e][r];for(const e of i)if(e in t)return t[e]}return null}(e,t,n,a,i,s);if(null!==l)return l}if(o.vocab&&"@vocab"in e){const n=e["@vocab"];if(0===t.indexOf(n)&&t!==n){const o=t.substr(n.length);if(!e.mappings.has(o))return o}}let s=null;const l=[];let c=e.fastCurieMap;const d=t.length-1;for(let e=0;e<d&&t[e]in c;++e)c=c[t[e]],""in c&&l.push(c[""][0]);for(let o=l.length-1;o>=0;--o){const r=l[o],a=r.terms;for(const o of a){const a=o+":"+t.substr(r.iri.length);e.mappings.get(o)._prefix&&(!e.mappings.has(a)||null===n&&e.mappings.get(a)["@id"]===t)&&(null===s||Cn(a,s)<0)&&(s=a)}}if(null!==s)return s;for(const[n,o]of e.mappings)if(o&&o._prefix&&t.startsWith(n+":"))throw new k(`Absolute IRI "${t}" confused with prefix "${n}".`,"jsonld.SyntaxError",{code:"IRI confused with prefix",context:e});return o.vocab?t:"@base"in e?e["@base"]?Nn(Sn(a,e["@base"]),t):t:Nn(a,t)},Ln.compactValue=({activeCtx:e,activeProperty:t,value:n,options:o})=>{if(vn(n)){const o=bn(e,t,"@type"),r=bn(e,t,"@language"),a=bn(e,t,"@direction"),i=bn(e,t,"@container")||[],s="@index"in n&&!i.includes("@index");if(!s&&"@none"!==o){if(n["@type"]===o)return n["@value"];if("@language"in n&&n["@language"]===r&&"@direction"in n&&n["@direction"]===a)return n["@value"];if("@language"in n&&n["@language"]===r)return n["@value"];if("@direction"in n&&n["@direction"]===a)return n["@value"]}const l=Object.keys(n).length,c=1===l||2===l&&"@index"in n&&!s,d="@language"in e,u=pn(n["@value"]),p=e.mappings.has(t)&&null===e.mappings.get(t)["@language"];if(c&&"@none"!==o&&(!d||!u||p))return n["@value"];const h={};return s&&(h[Ln.compactIri({activeCtx:e,iri:"@index",relativeTo:{vocab:!0}})]=n["@index"]),"@type"in n?h[Ln.compactIri({activeCtx:e,iri:"@type",relativeTo:{vocab:!0}})]=Ln.compactIri({activeCtx:e,iri:n["@type"],relativeTo:{vocab:!0}}):"@language"in n&&(h[Ln.compactIri({activeCtx:e,iri:"@language",relativeTo:{vocab:!0}})]=n["@language"]),"@direction"in n&&(h[Ln.compactIri({activeCtx:e,iri:"@direction",relativeTo:{vocab:!0}})]=n["@direction"]),h[Ln.compactIri({activeCtx:e,iri:"@value",relativeTo:{vocab:!0}})]=n["@value"],h}const r=xn(e,t,{vocab:!0},o),a=bn(e,t,"@type"),i=Ln.compactIri({activeCtx:e,iri:n["@id"],relativeTo:{vocab:"@vocab"===a},base:o.base});return"@id"===a||"@vocab"===a||"@graph"===r?i:{[Ln.compactIri({activeCtx:e,iri:"@id",relativeTo:{vocab:!0}})]:i}};var Tn=class{constructor(){this._requests={}}wrapLoader(e){const t=this;return t._loader=e,function(){return t.add.apply(t,arguments)}}async add(e){let t=this._requests[e];if(t)return Promise.resolve(t);t=this._requests[e]=this._loader(e);try{return await t}finally{delete this._requests[e]}}};const{parseLinkHeader:Rn,buildHeaders:En}=E,{LINK_HEADER_CONTEXT:_n}=vt,{prependBase:Mn}=P;var Pn=({secure:e,strictSSL:t=!0,maxRedirects:n=-1,request:o,headers:r={}}={strictSSL:!0,maxRedirects:-1,headers:{}})=>{r=En(r),o=o||x;const a=x;return(new Tn).wrapLoader((function(e){return i(e,[])}));async function i(s,l){if(0!==s.indexOf("http:")&&0!==s.indexOf("https:"))throw new k('URL could not be dereferenced; only "http" and "https" URLs are supported.',"jsonld.InvalidUrl",{code:"loading document failed",url:s});if(e&&0!==s.indexOf("https"))throw new k('URL could not be dereferenced; secure mode is enabled and the URL\'s scheme is not "https".',"jsonld.InvalidUrl",{code:"loading document failed",url:s});let c,d=null;if(null!==d)return d;let u=null;try{c=await function(e,t){return new Promise(((n,o)=>{e(t,((e,t,r)=>{e?o(e):n({res:t,body:r})}))}))}(o,{url:s,headers:r,strictSSL:t,followRedirect:!1})}catch(e){throw new k("URL could not be dereferenced, an error occurred.","jsonld.LoadDocumentError",{code:"loading document failed",url:s,cause:e})}const{res:p,body:h}=c;d={contextUrl:null,documentUrl:s,document:h||null};const f=a.STATUS_CODES[p.statusCode];if(p.statusCode>=400)throw new k(`URL "${s}" could not be dereferenced: ${f}`,"jsonld.InvalidUrl",{code:"loading document failed",url:s,httpStatusCode:p.statusCode});if(p.headers.link&&"application/ld+json"!==p.headers["content-type"]){const e=Rn(p.headers.link),t=e[_n];if(Array.isArray(t))throw new k("URL could not be dereferenced, it has more than one associated HTTP Link Header.","jsonld.InvalidUrl",{code:"multiple context link headers",url:s});t&&(d.contextUrl=t.target),u=e.alternate,u&&"application/ld+json"==u.type&&!(p.headers["content-type"]||"").match(/^application\/(\w*\+)?json$/)&&(p.headers.location=Mn(s,u.target))}if((u||p.statusCode>=300&&p.statusCode<400)&&p.headers.location){if(l.length===n)throw new k("URL could not be dereferenced; there were too many redirects.","jsonld.TooManyRedirects",{code:"loading document failed",url:s,httpStatusCode:p.statusCode,redirects:l});if(-1!==l.indexOf(s))throw new k("URL could not be dereferenced; infinite redirection was detected.","jsonld.InfiniteRedirectDetected",{code:"recursive context inclusion",url:s,httpStatusCode:p.statusCode,redirects:l});return l.push(s),i(p.headers.location,l)}return l.push(s),d}};const{parseLinkHeader:Jn,buildHeaders:Bn}=E,{LINK_HEADER_CONTEXT:Fn}=vt,{prependBase:Un}=P,qn=/(^|(\r\n))link:/i;var Vn=({secure:e,headers:t={},xhr:n}={headers:{}})=>{t=Bn(t);return(new Tn).wrapLoader((async function o(r){if(0!==r.indexOf("http:")&&0!==r.indexOf("https:"))throw new k('URL could not be dereferenced; only "http" and "https" URLs are supported.',"jsonld.InvalidUrl",{code:"loading document failed",url:r});if(e&&0!==r.indexOf("https"))throw new k('URL could not be dereferenced; secure mode is enabled and the URL\'s scheme is not "https".',"jsonld.InvalidUrl",{code:"loading document failed",url:r});let a;try{a=await function(e,t,n){const o=new(e=e||XMLHttpRequest);return new Promise(((e,r)=>{o.onload=()=>e(o),o.onerror=e=>r(e),o.open("GET",t,!0);for(const e in n)o.setRequestHeader(e,n[e]);o.send()}))}(n,r,t)}catch(e){throw new k("URL could not be dereferenced, an error occurred.","jsonld.LoadDocumentError",{code:"loading document failed",url:r,cause:e})}if(a.status>=400)throw new k("URL could not be dereferenced: "+a.statusText,"jsonld.LoadDocumentError",{code:"loading document failed",url:r,httpStatusCode:a.status});let i={contextUrl:null,documentUrl:r,document:a.response},s=null;const l=a.getResponseHeader("Content-Type");let c;qn.test(a.getAllResponseHeaders())&&(c=a.getResponseHeader("Link"));if(c&&"application/ld+json"!==l){const e=Jn(c),t=e[Fn];if(Array.isArray(t))throw new k("URL could not be dereferenced, it has more than one associated HTTP Link Header.","jsonld.InvalidUrl",{code:"multiple context link headers",url:r});t&&(i.contextUrl=t.target),s=e.alternate,s&&"application/ld+json"==s.type&&!(l||"").match(/^application\/(\w*\+)?json$/)&&(i=await o(Un(r,s.target)))}return i}))};
/**
 * A JavaScript implementation of the JSON-LD API.
 * @author Dave Longley
 * @license BSD 3-Clause License
 */
const zn=E.IdentifierIssuer,{expand:$n}=et,{flatten:Gn}=pt,{fromRDF:Hn}=Ct,{toRDF:Qn}=$t,{frameMergedOrDefault:Kn,cleanupNull:Xn}=Wt,{isArray:Zn,isObject:Wn,isString:Yn}=N,{isSubjectReference:eo}=O,{expandIri:to,getInitialContext:no,process:oo,processingMode:ro}=De,{compact:ao,compactIri:io}=An,{createNodeMap:so,createMergedNodeMap:lo,mergeNodeMaps:co}=lt,uo="undefined"!=typeof process&&process.versions&&process.versions.node,po=!uo&&("undefined"!=typeof window||"undefined"!=typeof self),ho=function(t){const n={},o=new le({max:100});function r(e,{documentLoader:n=t.documentLoader,...o}){return Object.assign({},{documentLoader:n},o,e)}return t.compact=async function(e,n,a){if(arguments.length<2)throw new TypeError("Could not compact, too few arguments.");if(null===n)throw new k("The compaction context must not be null.","jsonld.CompactError",{code:"invalid local context"});if(null===e)return null;let i;(a=r(a,{base:Yn(e)?e:"",compactArrays:!0,compactToRelative:!0,graph:!1,skipExpansion:!1,link:!1,issuer:new zn("_:b"),contextResolver:new ve({sharedCache:o})})).link&&(a.skipExpansion=!0),a.compactToRelative||delete a.base,i=a.skipExpansion?e:await t.expand(e,a);const s=await t.processContext(no(a),n,a);let l=await ao({activeCtx:s,element:i,options:a,compactionMap:a.compactionMap});a.compactArrays&&!a.graph&&Zn(l)?1===l.length?l=l[0]:0===l.length&&(l={}):a.graph&&Wn(l)&&(l=[l]),Wn(n)&&"@context"in n&&(n=n["@context"]),n=E.clone(n),Zn(n)||(n=[n]);const c=n;n=[];for(let e=0;e<c.length;++e)(!Wn(c[e])||Object.keys(c[e]).length>0)&&n.push(c[e]);const d=n.length>0;if(1===n.length&&(n=n[0]),Zn(l)){const e=io({activeCtx:s,iri:"@graph",relativeTo:{vocab:!0}}),t=l;l={},d&&(l["@context"]=n),l[e]=t}else if(Wn(l)&&d){const e=l;l={"@context":n};for(const t in e)l[t]=e[t]}return l},t.expand=async function(e,n){if(arguments.length<1)throw new TypeError("Could not expand, too few arguments.");!1===(n=r(n,{keepFreeFloatingNodes:!1,contextResolver:new ve({sharedCache:o})})).expansionMap&&(n.expansionMap=void 0);const a={},i=[];if("expandContext"in n){const e=E.clone(n.expandContext);Wn(e)&&"@context"in e?a.expandContext=e:a.expandContext={"@context":e},i.push(a.expandContext)}let s;if(Yn(e)){const o=await t.get(e,n);s=o.documentUrl,a.input=o.document,o.contextUrl&&(a.remoteContext={"@context":o.contextUrl},i.push(a.remoteContext))}else a.input=E.clone(e);"base"in n||(n.base=s||"");let l=no(n);for(const e of i)l=await oo({activeCtx:l,localCtx:e,options:n});let c=await $n({activeCtx:l,element:a.input,options:n,expansionMap:n.expansionMap});return Wn(c)&&"@graph"in c&&1===Object.keys(c).length?c=c["@graph"]:null===c&&(c=[]),Zn(c)||(c=[c]),c},t.flatten=async function(e,n,a){if(arguments.length<1)return new TypeError("Could not flatten, too few arguments.");n="function"==typeof n?null:n||null,a=r(a,{base:Yn(e)?e:"",contextResolver:new ve({sharedCache:o})});const i=await t.expand(e,a),s=Gn(i);if(null===n)return s;a.graph=!0,a.skipExpansion=!0;const l=await t.compact(s,n,a);return l},t.frame=async function(e,n,a){if(arguments.length<2)throw new TypeError("Could not frame, too few arguments.");if(a=r(a,{base:Yn(e)?e:"",embed:"@once",explicit:!1,requireAll:!1,omitDefault:!1,bnodesToClear:[],contextResolver:new ve({sharedCache:o})}),Yn(n)){const e=await t.get(n,a);if(n=e.document,e.contextUrl){let t=n["@context"];t?Zn(t)?t.push(e.contextUrl):t=[t,e.contextUrl]:t=e.contextUrl,n["@context"]=t}}const i=n&&n["@context"]||{},s=await t.processContext(no(a),i,a);a.hasOwnProperty("omitGraph")||(a.omitGraph=ro(s,1.1)),a.hasOwnProperty("pruneBlankNodeIdentifiers")||(a.pruneBlankNodeIdentifiers=ro(s,1.1));const l=await t.expand(e,a),c={...a};c.isFrame=!0,c.keepFreeFloatingNodes=!0;const d=await t.expand(n,c),u=Object.keys(n).map((e=>to(s,e,{vocab:!0})));c.merged=!u.includes("@graph"),c.is11=ro(s,1.1);const p=Kn(l,d,c);c.graph=!a.omitGraph,c.skipExpansion=!0,c.link={},c.framing=!0;let h=await t.compact(p,i,c);return c.link={},h=Xn(h,c),h},t.link=async function(e,n,o){const r={};return n&&(r["@context"]=n),r["@embed"]="@link",t.frame(e,r,o)},t.normalize=t.canonize=async function(e,n){if(arguments.length<1)throw new TypeError("Could not canonize, too few arguments.");if("inputFormat"in(n=r(n,{base:Yn(e)?e:"",algorithm:"URDNA2015",skipExpansion:!1,contextResolver:new ve({sharedCache:o})}))){if("application/n-quads"!==n.inputFormat&&"application/nquads"!==n.inputFormat)throw new k("Unknown canonicalization input format.","jsonld.CanonizeError");const t=me.parse(e);return j.canonize(t,n)}const a={...n};delete a.format,a.produceGeneralizedRdf=!1;const i=await t.toRDF(e,a);return j.canonize(i,n)},t.fromRDF=async function(e,t){if(arguments.length<1)throw new TypeError("Could not convert from RDF, too few arguments.");t=r(t,{format:Yn(e)?"application/n-quads":void 0});const{format:o}=t;let{rdfParser:a}=t;if(o){if(a=a||n[o],!a)throw new k("Unknown input format.","jsonld.UnknownFormat",{format:o})}else a=()=>e;const i=await a(e);return Hn(i,t)},t.toRDF=async function(e,n){if(arguments.length<1)throw new TypeError("Could not convert to RDF, too few arguments.");let a;a=(n=r(n,{base:Yn(e)?e:"",skipExpansion:!1,contextResolver:new ve({sharedCache:o})})).skipExpansion?e:await t.expand(e,n);const i=Qn(a,n);if(n.format){if("application/n-quads"===n.format||"application/nquads"===n.format)return await me.serialize(i);throw new k("Unknown output format.","jsonld.UnknownFormat",{format:n.format})}return i},t.createNodeMap=async function(e,n){if(arguments.length<1)throw new TypeError("Could not create node map, too few arguments.");n=r(n,{base:Yn(e)?e:"",contextResolver:new ve({sharedCache:o})});const a=await t.expand(e,n);return lo(a,n)},t.merge=async function(e,n,a){if(arguments.length<1)throw new TypeError("Could not merge, too few arguments.");if(!Zn(e))throw new TypeError('Could not merge, "docs" must be an array.');n="function"==typeof n?null:n||null,a=r(a,{contextResolver:new ve({sharedCache:o})});const i=await Promise.all(e.map((e=>{const n={...a};return t.expand(e,n)})));let s=!0;"mergeNodes"in a&&(s=a.mergeNodes);const l=a.issuer||new zn("_:b"),c={"@default":{}};for(let e=0;e<i.length;++e){const t=E.relabelBlankNodes(i[e],{issuer:new zn("_:b"+e+"-")}),n=s||0===e?c:{"@default":{}};if(so(t,n,"@default",l),n!==c)for(const e in n){const t=n[e];if(!(e in c)){c[e]=t;continue}const o=c[e];for(const e in t)e in o||(o[e]=t[e])}}const d=co(c),u=[],p=Object.keys(d).sort();for(let e=0;e<p.length;++e){const t=d[p[e]];eo(t)||u.push(t)}if(null===n)return u;a.graph=!0,a.skipExpansion=!0;const h=await t.compact(u,n,a);return h},Object.defineProperty(t,"documentLoader",{get:()=>t._documentLoader,set:e=>t._documentLoader=e}),t.documentLoader=async e=>{throw new k("Could not retrieve a JSON-LD document from the URL. URL dereferencing not implemented.","jsonld.LoadDocumentError",{code:"loading document failed",url:e})},t.get=async function(e,n){let o;o="function"==typeof n.documentLoader?n.documentLoader:t.documentLoader;const r=await o(e);try{if(!r.document)throw new k("No remote document found at the given URL.","jsonld.NullRemoteDocument");Yn(r.document)&&(r.document=JSON.parse(r.document))}catch(e){throw new k("Could not retrieve a JSON-LD document from the URL.","jsonld.LoadDocumentError",{code:"loading document failed",cause:e,remoteDoc:r})}return r},t.processContext=async function(e,t,n){return n=r(n,{base:"",contextResolver:new ve({sharedCache:o})}),null===t?no(n):(t=E.clone(t),Wn(t)&&"@context"in t||(t={"@context":t}),oo({activeCtx:e,localCtx:t,options:n}))},t.getContextValue=De.getContextValue,t.documentLoaders={},t.documentLoaders.node=Pn,t.documentLoaders.xhr=Vn,t.useDocumentLoader=function(e){if(!(e in t.documentLoaders))throw new k('Unknown document loader type: "'+e+'"',"jsonld.UnknownDocumentLoader",{type:e});t.documentLoader=t.documentLoaders[e].apply(t,Array.prototype.slice.call(arguments,1))},t.registerRDFParser=function(e,t){n[e]=t},t.unregisterRDFParser=function(e){delete n[e]},t.registerRDFParser("application/n-quads",me.parse),t.registerRDFParser("application/nquads",me.parse),t.url=P,t.util=E,Object.assign(t,E),t.promises=t,t.RequestQueue=Tn,t.JsonLdProcessor=(e=>{class t{toString(){return"[object JsonLdProcessor]"}}return Object.defineProperty(t,"prototype",{writable:!1,enumerable:!1}),Object.defineProperty(t.prototype,"constructor",{writable:!0,enumerable:!1,configurable:!0,value:t}),t.compact=function(t,n){return arguments.length<2?Promise.reject(new TypeError("Could not compact, too few arguments.")):e.compact(t,n)},t.expand=function(t){return arguments.length<1?Promise.reject(new TypeError("Could not expand, too few arguments.")):e.expand(t)},t.flatten=function(t){return arguments.length<1?Promise.reject(new TypeError("Could not flatten, too few arguments.")):e.flatten(t)},t})(t),po&&void 0===e.JsonLdProcessor&&Object.defineProperty(e,"JsonLdProcessor",{writable:!0,enumerable:!1,configurable:!0,value:t.JsonLdProcessor}),uo?t.useDocumentLoader("node"):"undefined"!=typeof XMLHttpRequest&&t.useDocumentLoader("xhr"),t}
const fo=function(){return ho((function(){return fo()}))};ho(fo);var vo=fo;
export const jsonld = Object.assign({
  expand: (json) => json,
  compact: (json, context) => json
}, fo)